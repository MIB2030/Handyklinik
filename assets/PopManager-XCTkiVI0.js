import{s as x,j as e}from"./index-B7riXxju.js";import{r as d}from"./react-vendor-CyQtAcHN.js";import{V as f,a1 as j,z as $,X as P,x as I,O as F,N as z}from"./icons-D7vnYvoJ.js";import"./supabase-BIynZPkb.js";const b=[{value:"red",label:"Rot (Wichtig/Warnung)",bgClass:"bg-red-100",textClass:"text-red-800",borderClass:"border-red-200"},{value:"blue",label:"Blau (Information)",bgClass:"bg-blue-100",textClass:"text-blue-800",borderClass:"border-blue-200"},{value:"green",label:"Grün (Erfolg/Positiv)",bgClass:"bg-green-100",textClass:"text-green-800",borderClass:"border-green-200"},{value:"orange",label:"Orange (Aufmerksamkeit)",bgClass:"bg-orange-100",textClass:"text-orange-800",borderClass:"border-orange-200"},{value:"yellow",label:"Gelb (Hinweis)",bgClass:"bg-yellow-100",textClass:"text-yellow-800",borderClass:"border-yellow-200"}],o={red:{bg:"bg-red-50",border:"border-red-200",text:"text-red-900",title:"text-red-800",button:"bg-red-600 hover:bg-red-700"},blue:{bg:"bg-blue-50",border:"border-blue-200",text:"text-blue-900",title:"text-blue-800",button:"bg-blue-600 hover:bg-blue-700"},green:{bg:"bg-green-50",border:"border-green-200",text:"text-green-900",title:"text-green-800",button:"bg-green-600 hover:bg-green-700"},orange:{bg:"bg-orange-50",border:"border-orange-200",text:"text-orange-900",title:"text-orange-800",button:"bg-orange-600 hover:bg-orange-700"},yellow:{bg:"bg-yellow-50",border:"border-yellow-200",text:"text-yellow-900",title:"text-yellow-800",button:"bg-yellow-600 hover:bg-yellow-700"}};function q(){const[h,y]=d.useState([]),[w,N]=d.useState(!0),[c,m]=d.useState(null),[t,l]=d.useState({title:"",message:"",color:"blue",is_active:!0,start_date:new Date().toISOString().slice(0,16),end_date:new Date(Date.now()+7*24*60*60*1e3).toISOString().slice(0,16)}),[p,n]=d.useState(null),[v,i]=d.useState(null);d.useEffect(()=>{u()},[]);const u=async()=>{try{const{data:s,error:r}=await x.from("announcements").select("*").order("created_at",{ascending:!1});if(r)throw r;y(s||[])}catch(s){n("Fehler beim Laden der Ankündigungen"),console.error(s)}finally{N(!1)}},k=async s=>{s.preventDefault(),n(null),i(null);try{if(c){const{error:r}=await x.from("announcements").update(t).eq("id",c);if(r)throw r;i("Änderungen wurden gespeichert und sind sofort für Endkunden sichtbar!")}else{const{error:r}=await x.from("announcements").insert([t]);if(r)throw r;i("Pop-up wurde erstellt und ist sofort für Endkunden sichtbar!")}l({title:"",message:"",color:"blue",is_active:!0,start_date:new Date().toISOString().slice(0,16),end_date:new Date(Date.now()+7*24*60*60*1e3).toISOString().slice(0,16)}),m(null),u(),setTimeout(()=>i(null),5e3)}catch(r){n("Fehler beim Speichern der Ankündigung"),console.error(r)}},C=s=>{l({title:s.title,message:s.message,color:s.color,is_active:s.is_active,start_date:new Date(s.start_date).toISOString().slice(0,16),end_date:new Date(s.end_date).toISOString().slice(0,16)}),m(s.id),window.scrollTo({top:0,behavior:"smooth"})},S=async s=>{if(confirm("Möchten Sie diese Ankündigung wirklich löschen?"))try{const{error:r}=await x.from("announcements").delete().eq("id",s);if(r)throw r;u()}catch(r){n("Fehler beim Löschen der Ankündigung"),console.error(r)}},_=async(s,r)=>{n(null),i(null);try{const{error:a}=await x.from("announcements").update({is_active:!r}).eq("id",s);if(a)throw a;i(!r?"Pop-up wurde aktiviert und ist jetzt für Endkunden sichtbar!":"Pop-up wurde deaktiviert und ist nicht mehr für Endkunden sichtbar!"),u(),setTimeout(()=>i(null),5e3)}catch(a){n("Fehler beim Aktualisieren des Status"),console.error(a)}},D=s=>b.find(a=>a.value===s)||b[1],E=s=>{if(!s.is_active)return!1;const r=new Date,a=new Date(s.start_date),g=new Date(s.end_date);return r>=a&&r<=g};return w?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-gray-600",children:"Laden..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Pop-up Ankündigungen"})}),p&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{children:p})]}),v&&e.jsxs("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg flex items-center gap-2 animate-fadeIn",children:[e.jsx("div",{className:"w-5 h-5 flex-shrink-0 flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),e.jsx("span",{className:"font-medium",children:v})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:c?"Ankündigung bearbeiten":"Neue Ankündigung"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Änderungen werden sofort für alle Endkunden wirksam. Deaktivierte Pop-ups werden nicht mehr angezeigt."})]}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Titel (optional)"}),e.jsx("input",{type:"text",value:t.title,onChange:s=>l({...t,title:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"z.B. Wichtige Ankündigung"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nachricht *"}),e.jsx("textarea",{value:t.message,onChange:s=>l({...t,message:s.target.value}),required:!0,rows:4,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ihre Ankündigungsnachricht..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Farbe *"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:b.map(s=>e.jsxs("label",{className:`flex items-center gap-3 p-3 border-2 rounded-lg cursor-pointer transition-all ${t.color===s.value?`${s.borderClass} ${s.bgClass}`:"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"color",value:s.value,checked:t.color===s.value,onChange:r=>l({...t,color:r.target.value}),className:"w-4 h-4"}),e.jsx("span",{className:`font-medium ${t.color===s.value?s.textClass:"text-gray-700"}`,children:s.label})]},s.value))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Startdatum *"}),e.jsx("input",{type:"datetime-local",value:t.start_date,onChange:s=>l({...t,start_date:s.target.value}),required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Enddatum *"}),e.jsx("input",{type:"datetime-local",value:t.end_date,onChange:s=>l({...t,end_date:s.target.value}),required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:t.is_active,onChange:s=>l({...t,is_active:s.target.checked}),className:"w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"is_active",className:"text-sm font-medium text-gray-900",children:"Pop-up für Endkunden aktivieren"})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-2 ml-7",children:t.is_active?"Das Pop-up wird Endkunden im angegebenen Zeitraum angezeigt":"Das Pop-up ist deaktiviert und wird Endkunden nicht angezeigt"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{type:"submit",className:"px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 font-semibold shadow-md hover:shadow-lg",children:c?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"w-5 h-5"}),"Änderungen speichern"]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-5 h-5"}),"Pop-up erstellen"]})}),c&&e.jsx("button",{type:"button",onClick:()=>{m(null),l({title:"",message:"",color:"blue",is_active:!0,start_date:new Date().toISOString().slice(0,16),end_date:new Date(Date.now()+7*24*60*60*1e3).toISOString().slice(0,16)})},className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:"Abbrechen"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Live-Vorschau"}),e.jsx("p",{className:"text-sm text-gray-600",children:"So wird das Pop-up für Endkunden angezeigt"})]}),e.jsx("div",{className:"relative bg-gray-100 rounded-lg p-4 min-h-[400px] flex items-center justify-center",children:t.message?e.jsx("div",{className:"relative w-full max-w-md",children:e.jsxs("div",{className:`relative ${o[t.color].bg} ${o[t.color].border} border-2 rounded-2xl shadow-2xl p-6 md:p-8`,children:[e.jsx("button",{type:"button",className:`absolute top-4 right-4 p-2 rounded-full ${o[t.color].button} text-white transition-all hover:scale-110`,disabled:!0,children:e.jsx(P,{className:"w-5 h-5"})}),e.jsxs("div",{className:"pr-10",children:[t.title&&e.jsx("h2",{className:`text-2xl md:text-3xl font-bold ${o[t.color].title} mb-4`,children:t.title}),e.jsx("p",{className:`text-base md:text-lg ${o[t.color].text} whitespace-pre-wrap leading-relaxed`,children:t.message})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{type:"button",className:`px-6 py-3 ${o[t.color].button} text-white font-semibold rounded-lg transition-all hover:scale-105`,disabled:!0,children:"Verstanden"})})]})}):e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx(f,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Geben Sie eine Nachricht ein, um die Vorschau zu sehen"})]})}),e.jsxs("div",{className:"mt-4 text-xs text-gray-500 space-y-1",children:[e.jsx("p",{children:"• Die Vorschau zeigt das exakte Design des Popups"}),e.jsx("p",{children:"• Buttons in der Vorschau sind deaktiviert"}),e.jsx("p",{children:"• Das echte Popup wird mittig auf dem Bildschirm angezeigt"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Alle Ankündigungen"})}),h.length===0?e.jsx("div",{className:"px-6 py-12 text-center text-gray-500",children:"Keine Ankündigungen vorhanden. Erstellen Sie die erste Ankündigung oben."}):e.jsx("div",{className:"divide-y divide-gray-200",children:h.map(s=>{var g;const r=D(s.color),a=E(s);return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[s.title&&e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.title}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${r.bgClass} ${r.textClass}`,children:(g=b.find(A=>A.value===s.color))==null?void 0:g.label.split(" ")[0]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${a?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"}`,children:a?"Aktiv":"Inaktiv"})]}),e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:s.message}),e.jsx("div",{className:"text-sm text-gray-500 space-y-1",children:e.jsxs("div",{children:["Von: ",new Date(s.start_date).toLocaleString("de-DE")," "," Bis: ",new Date(s.end_date).toLocaleString("de-DE")]})}),e.jsxs("div",{className:`mt-3 p-4 rounded-lg border-2 ${r.bgClass} ${r.borderClass}`,children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Vorschau:"}),s.title&&e.jsx("h4",{className:`text-lg font-bold mb-2 ${r.textClass}`,children:s.title}),e.jsx("p",{className:`${r.textClass}`,children:s.message})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{onClick:()=>_(s.id,s.is_active),className:`px-4 py-2 rounded-lg transition-all font-medium text-sm flex items-center gap-2 ${s.is_active?"bg-green-100 text-green-700 hover:bg-green-200 border border-green-300":"bg-gray-100 text-gray-700 hover:bg-gray-200 border border-gray-300"}`,title:s.is_active?"Für Endkunden deaktivieren":"Für Endkunden aktivieren",children:s.is_active?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Aktiv"})]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Inaktiv"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>C(s),className:"p-2 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 transition-colors",title:"Bearbeiten",children:e.jsx(j,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>S(s.id),className:"p-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition-colors",title:"Löschen",children:e.jsx(z,{className:"w-5 h-5"})})]})]})]})},s.id)})})]})]})}export{q as default};
