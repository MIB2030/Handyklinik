import{u as z,s as i,j as e}from"./index-DzINA5TK.js";import{r as c}from"./react-vendor-CyQtAcHN.js";import{z as E,k as _,K as B,N as S}from"./icons-D7vnYvoJ.js";import"./supabase-BIynZPkb.js";function q(){const[y,j]=c.useState([]),[v,h]=c.useState(!1),[s,d]=c.useState(null),[t,o]=c.useState({email:"",password:"",role:"admin",vorname:"",nachname:""}),[g,n]=c.useState(""),[b,m]=c.useState(""),{isAdmin:p}=z();c.useEffect(()=>{p&&x()},[p]);const x=async()=>{const{data:r,error:a}=await i.from("user_roles_with_email").select("id, user_id, role, created_at, email, vorname, nachname");if(a){m("Fehler beim Laden der Benutzer");return}if(r){const u=r.map(l=>({id:l.user_id,email:l.email,role:l.role,created_at:l.created_at,vorname:l.vorname||"",nachname:l.nachname||""}));j(u)}},w=async r=>{r.preventDefault(),m(""),n("");try{const{data:a,error:u}=await i.auth.signUp({email:t.email,password:t.password});if(u)throw u;if(!a.user)throw new Error("Kein Benutzer erstellt");const{error:l}=await i.from("user_roles").insert({user_id:a.user.id,role:t.role});if(l)throw l;const{error:f}=await i.from("user_profiles").insert({id:a.user.id,vorname:t.vorname,nachname:t.nachname,role:t.role});if(f)throw f;n("Benutzer erfolgreich hinzugefügt"),h(!1),o({email:"",password:"",role:"admin",vorname:"",nachname:""}),x(),setTimeout(()=>n(""),3e3)}catch(a){m(a.message||"Fehler beim Hinzufügen des Benutzers")}},N=async r=>{if(r.preventDefault(),!!s){m(""),n("");try{if(s.vorname||s.nachname){const{error:a}=await i.from("user_profiles").update({vorname:s.vorname,nachname:s.nachname,role:s.role}).eq("id",s.id);if(a)throw a}if(s.password){const{error:a}=await i.auth.updateUser({password:s.password});if(a)throw a}if(s.role){const{error:a}=await i.from("user_roles").update({role:s.role}).eq("user_id",s.id);if(a)throw a}n("Benutzer erfolgreich aktualisiert"),d(null),x(),setTimeout(()=>n(""),3e3)}catch(a){m(a.message||"Fehler beim Aktualisieren des Benutzers")}}},k=async r=>{if(!confirm("Möchten Sie diesen Benutzer wirklich löschen?"))return;const{error:a}=await i.from("user_roles").delete().eq("user_id",r);a||(n("Benutzer erfolgreich gelöscht"),x(),setTimeout(()=>n(""),3e3))};return p?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Benutzerverwaltung"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Admin-Benutzer verwalten"})]}),e.jsxs("button",{onClick:()=>h(!0),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(E,{className:"h-5 w-5"}),e.jsx("span",{children:"Benutzer hinzufügen"})]})]}),g&&e.jsx("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-lg text-green-800",children:g}),b&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg text-red-800",children:b}),v&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Neuen Benutzer hinzufügen"}),e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vorname"}),e.jsx("input",{type:"text",value:t.vorname,onChange:r=>o({...t,vorname:r.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nachname"}),e.jsx("input",{type:"text",value:t.nachname,onChange:r=>o({...t,nachname:r.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"E-Mail"}),e.jsx("input",{type:"email",value:t.email,onChange:r=>o({...t,email:r.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Passwort"}),e.jsx("input",{type:"password",value:t.password,onChange:r=>o({...t,password:r.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",required:!0,minLength:6})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rolle"}),e.jsxs("select",{value:t.role,onChange:r=>o({...t,role:r.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"editor",children:"Editor"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{type:"submit",className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",children:"Hinzufügen"}),e.jsx("button",{type:"button",onClick:()=>{h(!1),o({email:"",password:"",role:"admin",vorname:"",nachname:""}),m("")},className:"bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400",children:"Abbrechen"})]})]})]}),s&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Benutzer bearbeiten"}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vorname"}),e.jsx("input",{type:"text",value:s.vorname,onChange:r=>d({...s,vorname:r.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nachname"}),e.jsx("input",{type:"text",value:s.nachname,onChange:r=>d({...s,nachname:r.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"E-Mail"}),e.jsx("input",{type:"email",value:s.email,disabled:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Neues Passwort (leer lassen zum Beibehalten)"}),e.jsx("input",{type:"password",value:s.password||"",onChange:r=>d({...s,password:r.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",minLength:6})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rolle"}),e.jsxs("select",{value:s.role,onChange:r=>d({...s,role:r.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"editor",children:"Editor"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{type:"submit",className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",children:"Speichern"}),e.jsx("button",{type:"button",onClick:()=>{d(null),m("")},className:"bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400",children:"Abbrechen"})]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"E-Mail"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Rolle"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Erstellt am"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Aktionen"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:y.map(r=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-6 py-4 text-sm text-gray-900 font-medium",children:[r.vorname," ",r.nachname]}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:r.email}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.jsx(_,{className:"h-3 w-3 mr-1"}),r.role]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:new Date(r.created_at).toLocaleDateString("de-DE")}),e.jsxs("td",{className:"px-6 py-4 text-right text-sm space-x-2 flex justify-end",children:[e.jsx("button",{onClick:()=>d({...r,password:""}),className:"text-blue-600 hover:text-blue-900",children:e.jsx(B,{className:"h-5 w-5 inline"})}),e.jsx("button",{onClick:()=>k(r.id),className:"text-red-600 hover:text-red-900",children:e.jsx(S,{className:"h-5 w-5 inline"})})]})]},r.id))})]})})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-600",children:"Sie haben keine Berechtigung, diese Seite zu sehen."})})}export{q as default};
