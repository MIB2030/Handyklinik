import{s as g,j as e}from"./index-BEh_Cfkw.js";import{r as n}from"./react-vendor-CyQtAcHN.js";import{$ as A,a0 as f,z as E,x as I,O as F,N as P}from"./icons-uhig456p.js";import"./supabase-BIynZPkb.js";const x=[{value:"red",label:"Rot (Wichtig/Warnung)",bgClass:"bg-red-100",textClass:"text-red-800",borderClass:"border-red-200"},{value:"blue",label:"Blau (Information)",bgClass:"bg-blue-100",textClass:"text-blue-800",borderClass:"border-blue-200"},{value:"green",label:"Grün (Erfolg/Positiv)",bgClass:"bg-green-100",textClass:"text-green-800",borderClass:"border-green-200"},{value:"orange",label:"Orange (Aufmerksamkeit)",bgClass:"bg-orange-100",textClass:"text-orange-800",borderClass:"border-orange-200"},{value:"yellow",label:"Gelb (Hinweis)",bgClass:"bg-yellow-100",textClass:"text-yellow-800",borderClass:"border-yellow-200"}];function q(){const[h,v]=n.useState([]),[j,y]=n.useState(!0),[o,m]=n.useState(null),[t,l]=n.useState({title:"",message:"",color:"blue",is_active:!0,start_date:new Date().toISOString().slice(0,16),end_date:new Date(Date.now()+7*24*60*60*1e3).toISOString().slice(0,16)}),[b,d]=n.useState(null),[p,i]=n.useState(null);n.useEffect(()=>{u()},[]);const u=async()=>{try{const{data:s,error:r}=await g.from("announcements").select("*").order("created_at",{ascending:!1});if(r)throw r;v(s||[])}catch(s){d("Fehler beim Laden der Ankündigungen"),console.error(s)}finally{y(!1)}},w=async s=>{s.preventDefault(),d(null),i(null);try{if(o){const{error:r}=await g.from("announcements").update(t).eq("id",o);if(r)throw r;i("Änderungen wurden gespeichert und sind sofort für Endkunden sichtbar!")}else{const{error:r}=await g.from("announcements").insert([t]);if(r)throw r;i("Pop-up wurde erstellt und ist sofort für Endkunden sichtbar!")}l({title:"",message:"",color:"blue",is_active:!0,start_date:new Date().toISOString().slice(0,16),end_date:new Date(Date.now()+7*24*60*60*1e3).toISOString().slice(0,16)}),m(null),u(),setTimeout(()=>i(null),5e3)}catch(r){d("Fehler beim Speichern der Ankündigung"),console.error(r)}},N=s=>{l({title:s.title,message:s.message,color:s.color,is_active:s.is_active,start_date:new Date(s.start_date).toISOString().slice(0,16),end_date:new Date(s.end_date).toISOString().slice(0,16)}),m(s.id),window.scrollTo({top:0,behavior:"smooth"})},k=async s=>{if(confirm("Möchten Sie diese Ankündigung wirklich löschen?"))try{const{error:r}=await g.from("announcements").delete().eq("id",s);if(r)throw r;u()}catch(r){d("Fehler beim Löschen der Ankündigung"),console.error(r)}},C=async(s,r)=>{d(null),i(null);try{const{error:a}=await g.from("announcements").update({is_active:!r}).eq("id",s);if(a)throw a;i(!r?"Pop-up wurde aktiviert und ist jetzt für Endkunden sichtbar!":"Pop-up wurde deaktiviert und ist nicht mehr für Endkunden sichtbar!"),u(),setTimeout(()=>i(null),5e3)}catch(a){d("Fehler beim Aktualisieren des Status"),console.error(a)}},_=s=>x.find(a=>a.value===s)||x[1],S=s=>{if(!s.is_active)return!1;const r=new Date,a=new Date(s.start_date),c=new Date(s.end_date);return r>=a&&r<=c};return j?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-gray-600",children:"Laden..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Pop-up Ankündigungen"})}),b&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{children:b})]}),p&&e.jsxs("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg flex items-center gap-2 animate-fadeIn",children:[e.jsx("div",{className:"w-5 h-5 flex-shrink-0 flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),e.jsx("span",{className:"font-medium",children:p})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:o?"Ankündigung bearbeiten":"Neue Ankündigung"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Änderungen werden sofort für alle Endkunden wirksam. Deaktivierte Pop-ups werden nicht mehr angezeigt."})]}),e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Titel (optional)"}),e.jsx("input",{type:"text",value:t.title,onChange:s=>l({...t,title:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"z.B. Wichtige Ankündigung"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nachricht *"}),e.jsx("textarea",{value:t.message,onChange:s=>l({...t,message:s.target.value}),required:!0,rows:4,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ihre Ankündigungsnachricht..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Farbe *"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:x.map(s=>e.jsxs("label",{className:`flex items-center gap-3 p-3 border-2 rounded-lg cursor-pointer transition-all ${t.color===s.value?`${s.borderClass} ${s.bgClass}`:"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"color",value:s.value,checked:t.color===s.value,onChange:r=>l({...t,color:r.target.value}),className:"w-4 h-4"}),e.jsx("span",{className:`font-medium ${t.color===s.value?s.textClass:"text-gray-700"}`,children:s.label})]},s.value))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Startdatum *"}),e.jsx("input",{type:"datetime-local",value:t.start_date,onChange:s=>l({...t,start_date:s.target.value}),required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Enddatum *"}),e.jsx("input",{type:"datetime-local",value:t.end_date,onChange:s=>l({...t,end_date:s.target.value}),required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:t.is_active,onChange:s=>l({...t,is_active:s.target.checked}),className:"w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"is_active",className:"text-sm font-medium text-gray-900",children:"Pop-up für Endkunden aktivieren"})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-2 ml-7",children:t.is_active?"Das Pop-up wird Endkunden im angegebenen Zeitraum angezeigt":"Das Pop-up ist deaktiviert und wird Endkunden nicht angezeigt"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{type:"submit",className:"px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 font-semibold shadow-md hover:shadow-lg",children:o?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"w-5 h-5"}),"Änderungen speichern"]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-5 h-5"}),"Pop-up erstellen"]})}),o&&e.jsx("button",{type:"button",onClick:()=>{m(null),l({title:"",message:"",color:"blue",is_active:!0,start_date:new Date().toISOString().slice(0,16),end_date:new Date(Date.now()+7*24*60*60*1e3).toISOString().slice(0,16)})},className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:"Abbrechen"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Alle Ankündigungen"})}),h.length===0?e.jsx("div",{className:"px-6 py-12 text-center text-gray-500",children:"Keine Ankündigungen vorhanden. Erstellen Sie die erste Ankündigung oben."}):e.jsx("div",{className:"divide-y divide-gray-200",children:h.map(s=>{var c;const r=_(s.color),a=S(s);return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[s.title&&e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.title}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${r.bgClass} ${r.textClass}`,children:(c=x.find(D=>D.value===s.color))==null?void 0:c.label.split(" ")[0]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${a?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"}`,children:a?"Aktiv":"Inaktiv"})]}),e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:s.message}),e.jsx("div",{className:"text-sm text-gray-500 space-y-1",children:e.jsxs("div",{children:["Von: ",new Date(s.start_date).toLocaleString("de-DE")," "," Bis: ",new Date(s.end_date).toLocaleString("de-DE")]})}),e.jsxs("div",{className:`mt-3 p-4 rounded-lg border-2 ${r.bgClass} ${r.borderClass}`,children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Vorschau:"}),s.title&&e.jsx("h4",{className:`text-lg font-bold mb-2 ${r.textClass}`,children:s.title}),e.jsx("p",{className:`${r.textClass}`,children:s.message})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{onClick:()=>C(s.id,s.is_active),className:`px-4 py-2 rounded-lg transition-all font-medium text-sm flex items-center gap-2 ${s.is_active?"bg-green-100 text-green-700 hover:bg-green-200 border border-green-300":"bg-gray-100 text-gray-700 hover:bg-gray-200 border border-gray-300"}`,title:s.is_active?"Für Endkunden deaktivieren":"Für Endkunden aktivieren",children:s.is_active?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Aktiv"})]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Inaktiv"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>N(s),className:"p-2 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 transition-colors",title:"Bearbeiten",children:e.jsx(f,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>k(s.id),className:"p-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition-colors",title:"Löschen",children:e.jsx(P,{className:"w-5 h-5"})})]})]})]})},s.id)})})]})]})}export{q as default};
