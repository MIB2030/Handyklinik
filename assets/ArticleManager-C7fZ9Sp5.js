import{s as c,j as e}from"./index-BsgvsZYb.js";import{r as a}from"./react-vendor-CyQtAcHN.js";import{y as M,X as T,z as ee,J as te,K as se,S as le,F as re,N as ae,O as ie}from"./icons-wXJLC3aD.js";import"./supabase-BIynZPkb.js";const N=[{value:"blog",label:"Blog"},{value:"news",label:"News"},{value:"produkt",label:"Produkt"},{value:"ratgeber",label:"Ratgeber"},{value:"service",label:"Service"}];function ue(){var D;const[u,K]=a.useState([]),[w,V]=a.useState([]),[m,q]=a.useState([]),[H,$]=a.useState(!0),[O,f]=a.useState(!1),[o,k]=a.useState(null),[U,F]=a.useState(!1),[r,B]=a.useState(null),[x,A]=a.useState(""),[h,E]=a.useState("all"),[g,L]=a.useState("all"),[d,P]=a.useState("all"),[p,S]=a.useState([]),[b,j]=a.useState(!1),[s,i]=a.useState({title:"",slug:"",content:"",excerpt:"",image_url:"",category:"blog",status:"draft",price:"",meta_title:"",meta_description:"",manufacturer:""});a.useEffect(()=>{_(),R()},[]),a.useEffect(()=>{I()},[u,x,h,g,d]),a.useEffect(()=>{if(s.manufacturer){const t=m.filter(l=>l.toLowerCase().includes(s.manufacturer.toLowerCase()));S(t)}else S(m)},[s.manufacturer,m]),a.useEffect(()=>{const t=l=>{l.target.closest(".manufacturer-autocomplete")||j(!1)};if(b)return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[b]);const _=async()=>{try{const{data:t,error:l}=await c.from("articles").select("*").order("created_at",{ascending:!1});if(l)throw l;K(t||[])}catch(t){console.error("Fehler beim Laden der Artikel:",t)}finally{$(!1)}},R=async()=>{try{const{data:t,error:l}=await c.from("repair_prices").select("hersteller").order("hersteller");if(l)throw l;const n=Array.from(new Set((t||[]).map(v=>v.hersteller).filter(Boolean))).sort();q(n),S(n)}catch(t){console.error("Fehler beim Laden der Hersteller:",t)}},I=()=>{let t=[...u];if(x){const l=x.toLowerCase();t=t.filter(n=>n.title.toLowerCase().includes(l)||n.excerpt.toLowerCase().includes(l)||n.slug.toLowerCase().includes(l))}h!=="all"&&(t=t.filter(l=>l.category===h)),g!=="all"&&(t=t.filter(l=>l.status===g)),d!=="all"&&(d==="with_price"?t=t.filter(l=>l.price!==null&&l.price>0):d==="without_price"&&(t=t.filter(l=>l.price===null||l.price===0))),V(t)},Z=t=>t.toLowerCase().replace(/ä/g,"ae").replace(/ö/g,"oe").replace(/ü/g,"ue").replace(/ß/g,"ss").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""),J=t=>{i({...s,title:t,slug:Z(t),meta_title:s.meta_title||t})},X=async t=>{t.preventDefault();try{const{data:{user:l}}=await c.auth.getUser();if(!l){alert("Sie sind nicht angemeldet. Bitte melden Sie sich an.");return}const{data:n}=await c.from("user_profiles").select("role").eq("id",l.id).maybeSingle();if(!n||n.role!=="admin"){alert("Sie haben keine Berechtigung, Artikel zu erstellen oder zu bearbeiten.");return}const v={title:s.title,slug:s.slug,content:s.content,excerpt:s.excerpt,image_url:s.image_url,category:s.category,status:s.status,author_id:l.id,price:s.price?parseFloat(s.price):null,meta_title:s.meta_title||s.title,meta_description:s.meta_description||s.excerpt,manufacturer:s.manufacturer||null,published_at:s.status==="published"?(o==null?void 0:o.published_at)||new Date().toISOString():null};if(o){const{error:y}=await c.from("articles").update(v).eq("id",o.id);if(y){console.error("Update Fehler:",y),alert(`Fehler beim Aktualisieren: ${y.message}`);return}alert("Artikel erfolgreich aktualisiert!")}else{const{data:y,error:C}=await c.from("articles").insert([v]).select();if(C){console.error("Insert Fehler:",C),alert(`Fehler beim Erstellen: ${C.message}`);return}alert("Artikel erfolgreich erstellt!")}f(!1),k(null),z(),_()}catch(l){console.error("Fehler beim Speichern:",l),alert(`Fehler beim Speichern des Artikels: ${l.message||"Unbekannter Fehler"}`)}},G=t=>{var l;k(t),i({title:t.title,slug:t.slug,content:t.content,excerpt:t.excerpt,image_url:t.image_url,category:t.category,status:t.status,price:((l=t.price)==null?void 0:l.toString())||"",meta_title:t.meta_title,meta_description:t.meta_description,manufacturer:t.manufacturer||""}),f(!0)},Q=async t=>{if(confirm("Artikel wirklich löschen?"))try{const{error:l}=await c.from("articles").delete().eq("id",t);if(l)throw l;_()}catch(l){console.error("Fehler beim Löschen:",l),alert("Fehler beim Löschen des Artikels")}},W=()=>{B(s),F(!0)},z=()=>{i({title:"",slug:"",content:"",excerpt:"",image_url:"",category:"blog",status:"draft",price:"",meta_title:"",meta_description:"",manufacturer:""})},Y=()=>{f(!1),k(null),z()};return H?e.jsx("div",{className:"p-6",children:"Lädt..."}):U&&r?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-yellow-100 border-b-4 border-yellow-400 p-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(M,{className:"w-5 h-5"}),e.jsx("span",{className:"font-bold",children:"VORSCHAU-MODUS"})]})}),e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("button",{onClick:()=>F(!1),className:"mb-6 flex items-center gap-2 px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-700",children:[e.jsx(T,{className:"w-4 h-4"}),"Vorschau schließen"]}),e.jsxs("article",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:[r.image_url&&e.jsx("img",{src:r.image_url,alt:r.title,className:"w-full h-96 object-cover"}),e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:(D=N.find(t=>t.value===r.category))==null?void 0:D.label}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${r.status==="published"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:r.status==="published"?"Veröffentlicht":"Entwurf"}),r.price&&e.jsxs("span",{className:"ml-auto text-2xl font-bold text-blue-600",children:[parseFloat(r.price).toFixed(2)," €"]})]}),e.jsx("h1",{className:"text-4xl font-bold mb-4",children:r.title}),r.excerpt&&e.jsx("p",{className:"text-xl text-gray-600 mb-6",children:r.excerpt}),e.jsx("div",{className:"prose max-w-none",children:r.content.split(`
`).map((t,l)=>t.trim()&&e.jsx("p",{className:"mb-4",children:t},l))}),(r.meta_title||r.meta_description)&&e.jsxs("div",{className:"mt-8 p-4 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:[e.jsx("h3",{className:"font-bold mb-2 text-sm text-gray-500",children:"SEO Vorschau"}),e.jsx("div",{className:"text-blue-600 font-medium",children:r.meta_title||r.title}),e.jsxs("div",{className:"text-green-700 text-sm",children:["website.de/artikel/",r.slug]}),e.jsx("div",{className:"text-gray-600 text-sm mt-1",children:r.meta_description||r.excerpt})]})]})]})]})]}):O?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:o?"Artikel bearbeiten":"Neuer Artikel"}),e.jsx("button",{onClick:Y,className:"text-gray-600 hover:text-gray-800",children:e.jsx(T,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:X,className:"space-y-6 bg-white p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Kategorie"}),e.jsx("select",{value:s.category,onChange:t=>i({...s,category:t.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,children:N.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Status"}),e.jsxs("select",{value:s.status,onChange:t=>i({...s,status:t.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"draft",children:"Entwurf"}),e.jsx("option",{value:"published",children:"Veröffentlicht"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Titel *"}),e.jsx("input",{type:"text",value:s.title,onChange:t=>J(t.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"relative manufacturer-autocomplete",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Hersteller (optional)"}),e.jsx("input",{type:"text",value:s.manufacturer,onChange:t=>{i({...s,manufacturer:t.target.value}),j(!0)},onFocus:()=>j(!0),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Tippen Sie, um Hersteller zu suchen...",autoComplete:"off"}),b&&p.length>0&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-64 overflow-y-auto",children:[p.slice(0,20).map(t=>e.jsx("button",{type:"button",onClick:()=>{i({...s,manufacturer:t}),j(!1)},className:"w-full text-left px-4 py-2 hover:bg-blue-50 transition-colors border-b border-gray-100 last:border-b-0 text-sm",children:t},t)),p.length>20&&e.jsxs("div",{className:"px-4 py-2 text-sm text-gray-500 border-t bg-gray-50",children:["+",p.length-20," weitere Hersteller..."]})]}),b&&p.length===0&&s.manufacturer&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg p-4 text-gray-500 text-sm",children:"Keine passenden Hersteller gefunden"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:m.length>0?`${m.length} Hersteller verfügbar`:"Lade Hersteller..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"URL-Slug *"}),e.jsx("input",{type:"text",value:s.slug,onChange:t=>i({...s,slug:t.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",required:!0}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["URL: website.de/artikel/",s.slug]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Kurzbeschreibung (Excerpt)"}),e.jsx("textarea",{value:s.excerpt,onChange:t=>i({...s,excerpt:t.target.value}),rows:2,className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Kurze Zusammenfassung für Listen-Ansichten"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Inhalt *"}),e.jsx("textarea",{value:s.content,onChange:t=>i({...s,content:t.target.value}),rows:12,className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,placeholder:"Hauptinhalt des Artikels..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Bild URL"}),e.jsx("input",{type:"text",value:s.image_url,onChange:t=>i({...s,image_url:t.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"https://example.com/bild.jpg"}),s.image_url&&e.jsx("img",{src:s.image_url,alt:"Vorschau",className:"mt-2 w-full h-48 object-cover rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Preis (optional, für Produkte)"}),e.jsx("input",{type:"number",step:"0.01",value:s.price,onChange:t=>i({...s,price:t.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"19.99"})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"SEO Einstellungen"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Meta-Titel"}),e.jsx("input",{type:"text",value:s.meta_title,onChange:t=>i({...s,meta_title:t.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Falls leer, wird der Titel verwendet"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[s.meta_title.length,"/60 Zeichen"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Meta-Beschreibung"}),e.jsx("textarea",{value:s.meta_description,onChange:t=>i({...s,meta_description:t.target.value}),rows:2,className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Falls leer, wird die Kurzbeschreibung verwendet"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[s.meta_description.length,"/160 Zeichen"]})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{type:"submit",className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium",children:[e.jsx(ee,{className:"w-5 h-5"}),"Speichern"]}),e.jsxs("button",{type:"button",onClick:W,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 font-medium",children:[e.jsx(M,{className:"w-5 h-5"}),"Vorschau"]})]})]})]})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Artikel-Verwaltung"}),e.jsxs("p",{className:"text-gray-600",children:[w.length," von ",u.length," Artikeln"]})]}),e.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium",children:[e.jsx(te,{className:"w-5 h-5"}),"Neuer Artikel"]})]}),e.jsxs("div",{className:"mb-6 bg-white p-4 rounded-lg shadow",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(se,{className:"w-5 h-5 text-gray-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Filter & Suche"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Suche"}),e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:x,onChange:t=>A(t.target.value),placeholder:"Titel, Beschreibung...",className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kategorie"}),e.jsxs("select",{value:h,onChange:t=>E(t.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"Alle Kategorien"}),N.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:g,onChange:t=>L(t.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"Alle Status"}),e.jsx("option",{value:"published",children:"Veröffentlicht"}),e.jsx("option",{value:"draft",children:"Entwurf"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Preis"}),e.jsxs("select",{value:d,onChange:t=>P(t.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"Alle Preise"}),e.jsx("option",{value:"with_price",children:"Mit Preis"}),e.jsx("option",{value:"without_price",children:"Ohne Preis"})]})]})]}),(x||h!=="all"||g!=="all"||d!=="all")&&e.jsx("button",{onClick:()=>{A(""),E("all"),L("all"),P("all")},className:"mt-4 text-sm text-blue-600 hover:text-blue-800",children:"Filter zurücksetzen"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Titel"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Kategorie"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Preis"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Erstellt"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Aktionen"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:w.map(t=>{var l;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[t.image_url&&e.jsx("img",{src:t.image_url,alt:"",className:"w-12 h-12 object-cover rounded"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.title}),e.jsxs("div",{className:"text-sm text-gray-500",children:["/",t.slug]})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded text-sm",children:(l=N.find(n=>n.value===t.category))==null?void 0:l.label})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded text-sm ${t.status==="published"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:t.status==="published"?"Veröffentlicht":"Entwurf"})}),e.jsx("td",{className:"px-6 py-4",children:t.price?`${t.price.toFixed(2)} €`:"-"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:new Date(t.created_at).toLocaleDateString("de-DE")}),e.jsxs("td",{className:"px-6 py-4 text-right space-x-2",children:[e.jsx("a",{href:`/artikel/${t.slug}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-gray-600 hover:text-gray-800",children:e.jsx(re,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>G(t),className:"text-blue-600 hover:text-blue-800",children:e.jsx(ae,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Q(t.id),className:"text-red-600 hover:text-red-800",children:e.jsx(ie,{className:"w-4 h-4"})})]})]},t.id)})})]}),u.length===0&&e.jsx("div",{className:"text-center py-12 text-gray-500",children:"Noch keine Artikel vorhanden. Erstellen Sie den ersten Artikel!"}),u.length>0&&w.length===0&&e.jsx("div",{className:"text-center py-12 text-gray-500",children:"Keine Artikel gefunden, die Ihren Filterkriterien entsprechen."})]})]})}export{ue as default};
