import{s as g,j as e}from"./index-sL8Jvg43.js";import{r as a}from"./react-vendor-CyQtAcHN.js";import{z as O,y as P,X as A,K as Z,N as H,o as S,f as G,R as Y,x as J,l as M,m as L,e as Q,O as ee,V as se,Y as te,h as re,d as ae,Z as le}from"./icons-D7vnYvoJ.js";import"./supabase-BIynZPkb.js";function ne(){const[i,h]=a.useState([]),[b,N]=a.useState(null),[l,d]=a.useState({}),[_,j]=a.useState(!1),[f,u]=a.useState("");a.useEffect(()=>{m()},[]);const m=async()=>{const{data:t}=await g.from("testimonials").select("*").order("order_index");t&&h(t)},k=t=>{N(t.id),d(t)},p=()=>{N(null),d({})},y=async()=>{if(!b)return;const{error:t}=await g.from("testimonials").update(l).eq("id",b);t||(u("Erfolgreich gespeichert"),m(),p(),setTimeout(()=>u(""),3e3))},I=async()=>{const{error:t}=await g.from("testimonials").insert([{...l,order_index:i.length,is_active:!0}]);t||(u("Bewertung hinzugefügt"),m(),j(!1),d({}),setTimeout(()=>u(""),3e3))},w=async t=>{if(!confirm("Möchten Sie diese Bewertung wirklich löschen?"))return;const{error:c}=await g.from("testimonials").delete().eq("id",t);c||(u("Erfolgreich gelöscht"),m(),setTimeout(()=>u(""),3e3))},o=t=>Array.from({length:5},(c,C)=>e.jsx(S,{className:`h-5 w-5 ${C<t?"text-yellow-400 fill-current":"text-gray-300"}`},C));return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Bewertungen"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Kundenbewertungen verwalten"})]}),e.jsxs("button",{onClick:()=>j(!0),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(O,{className:"h-5 w-5"}),e.jsx("span",{children:"Hinzufügen"})]})]}),f&&e.jsx("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-lg text-green-800",children:f}),_&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Neue Bewertung hinzufügen"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Kundenname",value:l.customer_name||"",onChange:t=>d({...l,customer_name:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"}),e.jsx("textarea",{placeholder:"Bewertungstext",value:l.content||"",onChange:t=>d({...l,content:t.target.value}),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bewertung"}),e.jsxs("select",{value:l.rating||5,onChange:t=>d({...l,rating:parseInt(t.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:5,children:"5 Sterne"}),e.jsx("option",{value:4,children:"4 Sterne"}),e.jsx("option",{value:3,children:"3 Sterne"}),e.jsx("option",{value:2,children:"2 Sterne"}),e.jsx("option",{value:1,children:"1 Stern"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:I,className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",children:"Speichern"}),e.jsx("button",{onClick:()=>{j(!1),d({})},className:"bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400",children:"Abbrechen"})]})]})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:i.map(t=>e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:b===t.id?e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",value:l.customer_name||"",onChange:c=>d({...l,customer_name:c.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"}),e.jsx("textarea",{value:l.content||"",onChange:c=>d({...l,content:c.target.value}),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg"}),e.jsxs("select",{value:l.rating||5,onChange:c=>d({...l,rating:parseInt(c.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:5,children:"5 Sterne"}),e.jsx("option",{value:4,children:"4 Sterne"}),e.jsx("option",{value:3,children:"3 Sterne"}),e.jsx("option",{value:2,children:"2 Sterne"}),e.jsx("option",{value:1,children:"1 Stern"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:y,className:"flex items-center space-x-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",children:[e.jsx(P,{className:"h-4 w-4"}),e.jsx("span",{children:"Speichern"})]}),e.jsxs("button",{onClick:p,className:"flex items-center space-x-2 bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx("span",{children:"Abbrechen"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"flex",children:o(t.rating)}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>k(t),className:"text-blue-600 hover:text-blue-900",children:e.jsx(Z,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>w(t.id),className:"text-red-600 hover:text-red-900",children:e.jsx(H,{className:"h-5 w-5"})})]})]}),e.jsx("p",{className:"text-gray-600 mb-3",children:t.content}),e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:["- ",t.customer_name]})]})},t.id))})]})}function ie(){const[i,h]=a.useState([]),[b,N]=a.useState([]),[l,d]=a.useState({total:0,visible:0,featured:0,average_rating:0,five_star:0,four_star:0,three_star:0,two_star:0,one_star:0}),[_,j]=a.useState(!0),[f,u]=a.useState(!1),[m,k]=a.useState("all"),[p,y]=a.useState(!1),[I,w]=a.useState(!1),[o,t]=a.useState(!1),[c,C]=a.useState(null),[n,E]=a.useState({author_name:"",rating:5,text:"",time:new Date().toISOString().split("T")[0],author_photo_url:""});a.useEffect(()=>{R(),z()},[]),a.useEffect(()=>{i.length>0&&V(i)},[i]),a.useEffect(()=>{if(c){const s=setTimeout(()=>{C(null)},5e3);return()=>clearTimeout(s)}},[c]);const v=(s,r)=>{C({type:s,message:r})},R=async()=>{try{const{data:s,error:r}=await g.from("google_reviews").select("*").order("time",{ascending:!1});if(r)throw r;h(s||[])}catch(s){console.error("Error fetching reviews:",s)}finally{j(!1)}},z=async()=>{try{const{data:s,error:r}=await g.from("google_reviews_sync_log").select("*").order("synced_at",{ascending:!1}).limit(10);if(r)throw r;N(s||[])}catch(s){console.error("Error fetching sync logs:",s)}},V=s=>{const r=s.reduce((x,q)=>x+q.rating,0),F={total:s.length,visible:s.filter(x=>x.is_visible).length,featured:s.filter(x=>x.is_featured).length,average_rating:s.length>0?r/s.length:0,five_star:s.filter(x=>x.rating===5).length,four_star:s.filter(x=>x.rating===4).length,three_star:s.filter(x=>x.rating===3).length,two_star:s.filter(x=>x.rating===2).length,one_star:s.filter(x=>x.rating===1).length};d(F)},B=async()=>{u(!0);try{const s=await fetch("https://lnimxmbghbdadbotjyan.supabase.co/functions/v1/sync-google-reviews",{method:"POST",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxuaW14bWJnaGJkYWRib3RqeWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxMjMzMzgsImV4cCI6MjA4MDY5OTMzOH0.4jrkeiOdsY__oJ5FNFVYmcju2uklb5jXYYiUVt3F_Aw","Content-Type":"application/json",apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxuaW14bWJnaGJkYWRib3RqeWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxMjMzMzgsImV4cCI6MjA4MDY5OTMzOH0.4jrkeiOdsY__oJ5FNFVYmcju2uklb5jXYYiUVt3F_Aw"},body:JSON.stringify({triggeredBy:"manual"})}),r=await s.json();if(!s.ok)throw new Error(r.error||"Sync failed");v("success",`Erfolg! ${r.totalReviews} Bewertungen synchronisiert (${r.newReviews} neu, ${r.updatedReviews} aktualisiert)`),await R(),await z()}catch(s){console.error("Error syncing reviews:",s),v("error",`Fehler beim Synchronisieren: ${s.message}`)}finally{u(!1)}},K=async()=>{if(!n.author_name||!n.text){v("error","Bitte Name und Bewertungstext ausfüllen");return}t(!0);try{const r=`manual_${new Date(n.time).getTime()}_${n.author_name.replace(/\s/g,"_")}`,{error:F}=await g.from("google_reviews").insert({google_review_id:r,author_name:n.author_name,author_photo_url:n.author_photo_url||null,rating:n.rating,text:n.text,time:new Date(n.time).toISOString(),relative_time_description:"Manuell importiert",is_visible:!0,is_featured:n.rating===5});if(F)throw F;v("success","Bewertung erfolgreich hinzugefügt!"),w(!1),E({author_name:"",rating:5,text:"",time:new Date().toISOString().split("T")[0],author_photo_url:""}),await R()}catch(s){console.error("Error importing review:",s),v("error",`Fehler beim Importieren: ${s.message}`)}finally{t(!1)}},W=async s=>{try{const{error:r}=await g.from("google_reviews").update({is_visible:!s.is_visible}).eq("id",s.id);if(r)throw r;await R()}catch(r){console.error("Error toggling visibility:",r),v("error","Fehler beim Aktualisieren der Sichtbarkeit")}},X=async s=>{try{const{error:r}=await g.from("google_reviews").update({is_featured:!s.is_featured}).eq("id",s.id);if(r)throw r;await R()}catch(r){console.error("Error toggling featured:",r),v("error","Fehler beim Aktualisieren des Featured-Status")}},$=s=>new Date(s).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),U=s=>e.jsx("div",{className:"flex",children:[1,2,3,4,5].map(r=>e.jsx(S,{className:`w-4 h-4 ${r<=s?"text-yellow-400 fill-yellow-400":"text-gray-300"}`},r))}),D=(()=>{let s=[...i];return m!=="all"&&(s=s.filter(r=>r.rating===m)),p&&(s=s.filter(r=>r.is_visible)),s})();return _?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-600",children:"Lade Bewertungen..."})}):e.jsxs("div",{className:"space-y-6",children:[c&&e.jsxs("div",{className:`fixed top-4 right-4 z-50 max-w-md rounded-lg shadow-lg p-4 flex items-center space-x-3 ${c.type==="success"?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:[c.type==="success"?e.jsx(G,{className:"w-5 h-5 text-green-600 flex-shrink-0"}):e.jsx(A,{className:"w-5 h-5 text-red-600 flex-shrink-0"}),e.jsx("p",{className:`text-sm font-medium ${c.type==="success"?"text-green-800":"text-red-800"}`,children:c.message}),e.jsx("button",{onClick:()=>C(null),className:`ml-auto flex-shrink-0 ${c.type==="success"?"text-green-600 hover:text-green-800":"text-red-600 hover:text-red-800"}`,children:e.jsx(A,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Google Reviews Verwaltung"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:()=>w(!0),className:"inline-flex items-center space-x-2 bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors",children:[e.jsx(O,{className:"w-5 h-5"}),e.jsx("span",{children:"Manuell hinzufügen"})]}),e.jsxs("button",{onClick:B,disabled:f,className:"inline-flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Y,{className:`w-5 h-5 ${f?"animate-spin":""}`}),e.jsx("span",{children:f?"Synchronisieren":"Google Sync"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Gesamt"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:l.total})]}),e.jsx(S,{className:"w-12 h-12 text-blue-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Sichtbar"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:l.visible})]}),e.jsx(J,{className:"w-12 h-12 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Featured"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-600",children:l.featured})]}),e.jsx(M,{className:"w-12 h-12 text-yellow-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Durchschnitt"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-500",children:l.average_rating.toFixed(1)})]}),e.jsx(L,{className:"w-12 h-12 text-yellow-500"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"Bewertungsverteilung"}),e.jsx("div",{className:"space-y-3",children:[5,4,3,2,1].map(s=>{const r=l[`${["","","one","two","three","four","five"][s]}_star`],F=l.total>0?r/l.total*100:0;return e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-1 w-20",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:s}),e.jsx(S,{className:"w-4 h-4 text-yellow-400 fill-yellow-400"})]}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-4",children:e.jsx("div",{className:"bg-yellow-400 h-4 rounded-full transition-all",style:{width:`${F}%`}})}),e.jsx("span",{className:"text-sm font-medium text-gray-700 w-12 text-right",children:r})]},s)})})]}),b.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"Letzte Synchronisationen"}),e.jsx("div",{className:"space-y-2",children:b.slice(0,5).map(s=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b last:border-b-0",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Q,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600",children:$(s.synced_at)}),s.status==="success"?e.jsx(G,{className:"w-4 h-4 text-green-600"}):e.jsx(A,{className:"w-4 h-4 text-red-600"})]}),e.jsxs("div",{className:"text-sm text-gray-700",children:[s.reviews_count," Reviews (",s.new_reviews_count," neu)",s.triggered_by==="manual"&&e.jsx("span",{className:"ml-2 text-xs text-blue-600",children:"(Manuell)"})]})]},s.id))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("select",{value:m,onChange:s=>k(s.target.value==="all"?"all":Number(s.target.value)),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"Alle Bewertungen"}),e.jsx("option",{value:"5",children:"5 Sterne"}),e.jsx("option",{value:"4",children:"4 Sterne"}),e.jsx("option",{value:"3",children:"3 Sterne"}),e.jsx("option",{value:"2",children:"2 Sterne"}),e.jsx("option",{value:"1",children:"1 Stern"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:s=>y(s.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Nur sichtbare"})]})]})}),e.jsxs("div",{className:"divide-y divide-gray-200",children:[D.map(s=>e.jsx("div",{className:"p-6 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex space-x-4 flex-1",children:[s.author_photo_url&&e.jsx("img",{src:s.author_photo_url,alt:s.author_name,className:"w-12 h-12 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.author_name}),s.is_featured&&e.jsx(M,{className:"w-4 h-4 text-yellow-500"})]}),U(s.rating),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:$(s.time)}),s.text&&e.jsx("p",{className:"text-gray-700 mt-3",children:s.text})]})]}),e.jsxs("div",{className:"flex flex-col space-y-2 ml-4",children:[e.jsx("button",{onClick:()=>W(s),className:`p-2 rounded-lg transition-colors ${s.is_visible?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,title:s.is_visible?"Ausblenden":"Einblenden",children:s.is_visible?e.jsx(J,{className:"w-5 h-5"}):e.jsx(ee,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>X(s),className:`p-2 rounded-lg transition-colors ${s.is_featured?"bg-yellow-100 text-yellow-700 hover:bg-yellow-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,title:s.is_featured?"Von Featured entfernen":"Als Featured markieren",children:e.jsx(M,{className:"w-5 h-5"})})]})]})},s.id)),D.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(S,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Keine Bewertungen gefunden"}),i.length===0&&e.jsx("button",{onClick:B,disabled:f,className:"mt-4 text-blue-600 hover:text-blue-700 font-medium",children:"Jetzt Google Reviews synchronisieren"})]})]})]}),I&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Bewertung manuell hinzufügen"}),e.jsx("button",{onClick:()=>w(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(A,{className:"w-6 h-6"})})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Hinweis: Google Places API gibt max. 5 Reviews zurück. Hier können Sie weitere Bewertungen manuell hinzufügen."})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name des Bewerters *"}),e.jsx("input",{type:"text",value:n.author_name,onChange:s=>E({...n,author_name:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"z.B. Max Mustermann"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bewertung *"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[[1,2,3,4,5].map(s=>e.jsx("button",{onClick:()=>E({...n,rating:s}),className:"focus:outline-none",children:e.jsx(S,{className:`w-8 h-8 transition-colors ${s<=n.rating?"text-yellow-400 fill-yellow-400":"text-gray-300"}`})},s)),e.jsxs("span",{className:"ml-2 text-lg font-medium text-gray-700",children:[n.rating," Stern",n.rating!==1?"e":""]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bewertungstext *"}),e.jsx("textarea",{value:n.text,onChange:s=>E({...n,text:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:4,placeholder:"Bewertungstext..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Datum der Bewertung *"}),e.jsx("input",{type:"date",value:n.time,onChange:s=>E({...n,time:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Profilbild-URL (optional)"}),e.jsx("input",{type:"url",value:n.author_photo_url,onChange:s=>E({...n,author_photo_url:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"https://..."})]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-200 flex items-center justify-end space-x-3",children:[e.jsx("button",{onClick:()=>w(!1),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Abbrechen"}),e.jsx("button",{onClick:K,disabled:o,className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:o?"Wird hinzugefügt...":"Bewertung hinzufügen"})]})]})})]})}const T="00000000-0000-0000-0000-000000000001";function oe(){const[i,h]=a.useState(null),[b,N]=a.useState(""),[l,d]=a.useState(""),[_,j]=a.useState(!1),[f,u]=a.useState(!0),[m,k]=a.useState(!1),[p,y]=a.useState(null);a.useEffect(()=>{I()},[]);const I=async()=>{try{const{data:o,error:t}=await g.from("google_settings").select("*").eq("id",T).maybeSingle();if(t)throw t;o&&(h(o),N(o.api_key||""),d(o.place_id||""),j(o.auto_sync_enabled||!1))}catch(o){console.error("Error fetching settings:",o),y({type:"error",text:"Fehler beim Laden der Einstellungen"})}finally{u(!1)}},w=async o=>{o.preventDefault(),k(!0),y(null);try{const{error:t}=await g.from("google_settings").upsert({id:T,api_key:b.trim()||null,place_id:l.trim()||null,auto_sync_enabled:_,updated_at:new Date().toISOString()},{onConflict:"id"});if(t)throw t;y({type:"success",text:"Einstellungen erfolgreich gespeichert!"}),await I()}catch(t){console.error("Error saving settings:",t),y({type:"error",text:"Fehler beim Speichern der Einstellungen"})}finally{k(!1)}};return f?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"max-w-2xl",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(se,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-2",children:"So richten Sie Google Reviews ein:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1 ml-2",children:[e.jsxs("li",{children:["Besuchen Sie die ",e.jsx("a",{href:"https://console.cloud.google.com/",target:"_blank",rel:"noopener noreferrer",className:"underline font-medium",children:"Google Cloud Console"})]}),e.jsx("li",{children:"Erstellen Sie ein neues Projekt oder wählen Sie ein bestehendes aus"}),e.jsx("li",{children:'Aktivieren Sie die "Places API" für Ihr Projekt'}),e.jsx("li",{children:'Erstellen Sie einen API-Schlüssel unter "APIs & Dienste" → "Anmeldedaten"'}),e.jsxs("li",{children:["Finden Sie Ihre Place ID über die ",e.jsx("a",{href:"https://developers.google.com/maps/documentation/places/web-service/place-id",target:"_blank",rel:"noopener noreferrer",className:"underline font-medium",children:"Place ID Finder"})]})]})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Google API Einstellungen"}),p&&e.jsx("div",{className:`mb-6 p-4 rounded-lg ${p.type==="success"?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"}`,children:p.text}),e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 mb-2",children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Google Places API Key"]}),e.jsx("input",{type:"text",value:b,onChange:o=>N(o.target.value),placeholder:"AIzaSy...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Ihr API-Schlüssel aus der Google Cloud Console"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 mb-2",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Google Place ID"]}),e.jsx("input",{type:"text",value:l,onChange:o=>d(o.target.value),placeholder:"ChIJ...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Die eindeutige ID Ihres Google Business Profils"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Y,{className:"w-5 h-5 text-gray-600 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Automatische Synchronisierung"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Reviews automatisch alle 24 Stunden abrufen"})]})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:_,onChange:o=>j(o.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),(i==null?void 0:i.last_sync_at)&&e.jsxs("div",{className:"text-xs text-gray-500 bg-gray-50 p-3 rounded",children:["Letzte Synchronisierung: ",new Date(i.last_sync_at).toLocaleString("de-DE")]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs("button",{type:"submit",disabled:m,className:"flex items-center space-x-2 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{children:m?"Speichern...":"Einstellungen speichern"})]})})]})]})]})}function ge(){const[i,h]=a.useState("testimonials");return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Google Bewertungen"}),e.jsx("p",{className:"text-gray-600",children:"Verwalten Sie Kundenbewertungen und Google Reviews"})]}),e.jsx("div",{className:"border-b border-gray-200 mb-6",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsxs("button",{onClick:()=>h("testimonials"),className:`
              flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors
              ${i==="testimonials"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
            `,children:[e.jsx(S,{className:"w-5 h-5"}),e.jsx("span",{children:"Bewertungen"})]}),e.jsxs("button",{onClick:()=>h("reviews"),className:`
              flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors
              ${i==="reviews"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
            `,children:[e.jsx(ae,{className:"w-5 h-5"}),e.jsx("span",{children:"Google Reviews"})]}),e.jsxs("button",{onClick:()=>h("settings"),className:`
              flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors
              ${i==="settings"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
            `,children:[e.jsx(le,{className:"w-5 h-5"}),e.jsx("span",{children:"Einstellungen"})]})]})}),e.jsxs("div",{className:"mt-6",children:[i==="testimonials"&&e.jsx(ne,{}),i==="reviews"&&e.jsx(ie,{}),i==="settings"&&e.jsx(oe,{})]})]})}export{ge as default};
