import{s as x,j as e}from"./index-zgpJ7CUY.js";import{r as l}from"./react-vendor-CyQtAcHN.js";import{z,y as G,X as T,K as M,N as O,o as j,R as V,x as B,l as E,m as D,e as K,f as q,O as I,d as J}from"./icons-DQcJC5dO.js";import"./supabase-BIynZPkb.js";function P(){const[i,u]=l.useState([]),[b,v]=l.useState(null),[a,c]=l.useState({}),[_,y]=l.useState(!1),[g,d]=l.useState("");l.useEffect(()=>{h()},[]);const h=async()=>{const{data:t}=await x.from("testimonials").select("*").order("order_index");t&&u(t)},S=t=>{v(t.id),c(t)},p=()=>{v(null),c({})},C=async()=>{if(!b)return;const{error:t}=await x.from("testimonials").update(a).eq("id",b);t||(d("Erfolgreich gespeichert"),h(),p(),setTimeout(()=>d(""),3e3))},f=async()=>{const{error:t}=await x.from("testimonials").insert([{...a,order_index:i.length,is_active:!0}]);t||(d("Bewertung hinzugefügt"),h(),y(!1),c({}),setTimeout(()=>d(""),3e3))},w=async t=>{if(!confirm("Möchten Sie diese Bewertung wirklich löschen?"))return;const{error:o}=await x.from("testimonials").delete().eq("id",t);o||(d("Erfolgreich gelöscht"),h(),setTimeout(()=>d(""),3e3))},k=t=>Array.from({length:5},(o,N)=>e.jsx(j,{className:`h-5 w-5 ${N<t?"text-yellow-400 fill-current":"text-gray-300"}`},N));return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Bewertungen"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Kundenbewertungen verwalten"})]}),e.jsxs("button",{onClick:()=>y(!0),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(z,{className:"h-5 w-5"}),e.jsx("span",{children:"Hinzufügen"})]})]}),g&&e.jsx("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-lg text-green-800",children:g}),_&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Neue Bewertung hinzufügen"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Kundenname",value:a.customer_name||"",onChange:t=>c({...a,customer_name:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"}),e.jsx("textarea",{placeholder:"Bewertungstext",value:a.content||"",onChange:t=>c({...a,content:t.target.value}),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bewertung"}),e.jsxs("select",{value:a.rating||5,onChange:t=>c({...a,rating:parseInt(t.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:5,children:"5 Sterne"}),e.jsx("option",{value:4,children:"4 Sterne"}),e.jsx("option",{value:3,children:"3 Sterne"}),e.jsx("option",{value:2,children:"2 Sterne"}),e.jsx("option",{value:1,children:"1 Stern"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:f,className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",children:"Speichern"}),e.jsx("button",{onClick:()=>{y(!1),c({})},className:"bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400",children:"Abbrechen"})]})]})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:i.map(t=>e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:b===t.id?e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",value:a.customer_name||"",onChange:o=>c({...a,customer_name:o.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"}),e.jsx("textarea",{value:a.content||"",onChange:o=>c({...a,content:o.target.value}),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg"}),e.jsxs("select",{value:a.rating||5,onChange:o=>c({...a,rating:parseInt(o.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:5,children:"5 Sterne"}),e.jsx("option",{value:4,children:"4 Sterne"}),e.jsx("option",{value:3,children:"3 Sterne"}),e.jsx("option",{value:2,children:"2 Sterne"}),e.jsx("option",{value:1,children:"1 Stern"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:C,className:"flex items-center space-x-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx("span",{children:"Speichern"})]}),e.jsxs("button",{onClick:p,className:"flex items-center space-x-2 bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400",children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx("span",{children:"Abbrechen"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"flex",children:k(t.rating)}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>S(t),className:"text-blue-600 hover:text-blue-900",children:e.jsx(M,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>w(t.id),className:"text-red-600 hover:text-red-900",children:e.jsx(O,{className:"h-5 w-5"})})]})]}),e.jsx("p",{className:"text-gray-600 mb-3",children:t.content}),e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:["- ",t.customer_name]})]})},t.id))})]})}function H(){const[i,u]=l.useState([]),[b,v]=l.useState([]),[a,c]=l.useState({total:0,visible:0,featured:0,average_rating:0,five_star:0,four_star:0,three_star:0,two_star:0,one_star:0}),[_,y]=l.useState(!0),[g,d]=l.useState(!1),[h,S]=l.useState("all"),[p,C]=l.useState(!1);l.useEffect(()=>{f(),w()},[]),l.useEffect(()=>{i.length>0&&k(i)},[i]);const f=async()=>{try{const{data:s,error:r}=await x.from("google_reviews").select("*").order("time",{ascending:!1});if(r)throw r;u(s||[])}catch(s){console.error("Error fetching reviews:",s)}finally{y(!1)}},w=async()=>{try{const{data:s,error:r}=await x.from("google_reviews_sync_log").select("*").order("synced_at",{ascending:!1}).limit(10);if(r)throw r;v(s||[])}catch(s){console.error("Error fetching sync logs:",s)}},k=s=>{const r=s.reduce((n,A)=>n+A.rating,0),m={total:s.length,visible:s.filter(n=>n.is_visible).length,featured:s.filter(n=>n.is_featured).length,average_rating:s.length>0?r/s.length:0,five_star:s.filter(n=>n.rating===5).length,four_star:s.filter(n=>n.rating===4).length,three_star:s.filter(n=>n.rating===3).length,two_star:s.filter(n=>n.rating===2).length,one_star:s.filter(n=>n.rating===1).length};c(m)},t=async()=>{d(!0);try{const{data:{session:s}}=await x.auth.getSession();if(!s)throw new Error("No session");const r=await fetch("https://lnimxmbghbdadbotjyan.supabase.co/functions/v1/sync-google-reviews",{method:"POST",headers:{Authorization:`Bearer ${s.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({triggeredBy:"manual"})}),m=await r.json();if(!r.ok)throw new Error(m.error||"Sync failed");alert(`Erfolg! ${m.reviews_count} Bewertungen synchronisiert (${m.new_reviews_count} neu)`),await f(),await w()}catch(s){console.error("Error syncing reviews:",s),alert(`Fehler beim Synchronisieren: ${s.message}`)}finally{d(!1)}},o=async s=>{try{const{error:r}=await x.from("google_reviews").update({is_visible:!s.is_visible}).eq("id",s.id);if(r)throw r;await f()}catch(r){console.error("Error toggling visibility:",r),alert("Fehler beim Aktualisieren der Sichtbarkeit")}},N=async s=>{try{const{error:r}=await x.from("google_reviews").update({is_featured:!s.is_featured}).eq("id",s.id);if(r)throw r;await f()}catch(r){console.error("Error toggling featured:",r),alert("Fehler beim Aktualisieren des Featured-Status")}},F=s=>new Date(s).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),$=s=>e.jsx("div",{className:"flex",children:[1,2,3,4,5].map(r=>e.jsx(j,{className:`w-4 h-4 ${r<=s?"text-yellow-400 fill-yellow-400":"text-gray-300"}`},r))}),R=(()=>{let s=[...i];return h!=="all"&&(s=s.filter(r=>r.rating===h)),p&&(s=s.filter(r=>r.is_visible)),s})();return _?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-600",children:"Lade Bewertungen..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Google Reviews Verwaltung"}),e.jsxs("button",{onClick:t,disabled:g,className:"inline-flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(V,{className:`w-5 h-5 ${g?"animate-spin":""}`}),e.jsx("span",{children:g?"Synchronisiere...":"Jetzt synchronisieren"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Gesamt"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:a.total})]}),e.jsx(j,{className:"w-12 h-12 text-blue-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Sichtbar"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:a.visible})]}),e.jsx(B,{className:"w-12 h-12 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Featured"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-600",children:a.featured})]}),e.jsx(E,{className:"w-12 h-12 text-yellow-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Durchschnitt"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-500",children:a.average_rating.toFixed(1)})]}),e.jsx(D,{className:"w-12 h-12 text-yellow-500"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"Bewertungsverteilung"}),e.jsx("div",{className:"space-y-3",children:[5,4,3,2,1].map(s=>{const r=a[`${["","","one","two","three","four","five"][s]}_star`],m=a.total>0?r/a.total*100:0;return e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-1 w-20",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:s}),e.jsx(j,{className:"w-4 h-4 text-yellow-400 fill-yellow-400"})]}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-4",children:e.jsx("div",{className:"bg-yellow-400 h-4 rounded-full transition-all",style:{width:`${m}%`}})}),e.jsx("span",{className:"text-sm font-medium text-gray-700 w-12 text-right",children:r})]},s)})})]}),b.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"Letzte Synchronisationen"}),e.jsx("div",{className:"space-y-2",children:b.slice(0,5).map(s=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b last:border-b-0",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(K,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600",children:F(s.synced_at)}),s.status==="success"?e.jsx(q,{className:"w-4 h-4 text-green-600"}):e.jsx(T,{className:"w-4 h-4 text-red-600"})]}),e.jsxs("div",{className:"text-sm text-gray-700",children:[s.reviews_count," Reviews (",s.new_reviews_count," neu)",s.triggered_by==="manual"&&e.jsx("span",{className:"ml-2 text-xs text-blue-600",children:"(Manuell)"})]})]},s.id))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("select",{value:h,onChange:s=>S(s.target.value==="all"?"all":Number(s.target.value)),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"Alle Bewertungen"}),e.jsx("option",{value:"5",children:"5 Sterne"}),e.jsx("option",{value:"4",children:"4 Sterne"}),e.jsx("option",{value:"3",children:"3 Sterne"}),e.jsx("option",{value:"2",children:"2 Sterne"}),e.jsx("option",{value:"1",children:"1 Stern"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:s=>C(s.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Nur sichtbare"})]})]})}),e.jsxs("div",{className:"divide-y divide-gray-200",children:[R.map(s=>e.jsx("div",{className:"p-6 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex space-x-4 flex-1",children:[s.author_photo_url&&e.jsx("img",{src:s.author_photo_url,alt:s.author_name,className:"w-12 h-12 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.author_name}),s.is_featured&&e.jsx(E,{className:"w-4 h-4 text-yellow-500"})]}),$(s.rating),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:F(s.time)}),s.text&&e.jsx("p",{className:"text-gray-700 mt-3",children:s.text})]})]}),e.jsxs("div",{className:"flex flex-col space-y-2 ml-4",children:[e.jsx("button",{onClick:()=>o(s),className:`p-2 rounded-lg transition-colors ${s.is_visible?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,title:s.is_visible?"Ausblenden":"Einblenden",children:s.is_visible?e.jsx(B,{className:"w-5 h-5"}):e.jsx(I,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>N(s),className:`p-2 rounded-lg transition-colors ${s.is_featured?"bg-yellow-100 text-yellow-700 hover:bg-yellow-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,title:s.is_featured?"Von Featured entfernen":"Als Featured markieren",children:e.jsx(E,{className:"w-5 h-5"})})]})]})},s.id)),R.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(j,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Keine Bewertungen gefunden"}),i.length===0&&e.jsx("button",{onClick:t,disabled:g,className:"mt-4 text-blue-600 hover:text-blue-700 font-medium",children:"Jetzt Google Reviews synchronisieren"})]})]})]})]})}function Z(){const[i,u]=l.useState("testimonials");return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Google Bewertungen"}),e.jsx("p",{className:"text-gray-600",children:"Verwalten Sie Kundenbewertungen und Google Reviews"})]}),e.jsx("div",{className:"border-b border-gray-200 mb-6",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsxs("button",{onClick:()=>u("testimonials"),className:`
              flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors
              ${i==="testimonials"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
            `,children:[e.jsx(j,{className:"w-5 h-5"}),e.jsx("span",{children:"Bewertungen"})]}),e.jsxs("button",{onClick:()=>u("reviews"),className:`
              flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors
              ${i==="reviews"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
            `,children:[e.jsx(J,{className:"w-5 h-5"}),e.jsx("span",{children:"Google Reviews"})]})]})}),e.jsxs("div",{className:"mt-6",children:[i==="testimonials"&&e.jsx(P,{}),i==="reviews"&&e.jsx(H,{})]})]})}export{Z as default};
