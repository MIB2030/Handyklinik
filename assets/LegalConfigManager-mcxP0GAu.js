import{s as c,j as e}from"./index-BuXWCL45.js";import{r}from"./react-vendor-CyQtAcHN.js";import{p as I,$ as b,O as C,x as A,j as E}from"./icons-DQcJC5dO.js";import"./supabase-BIynZPkb.js";function T(){const[l,j]=r.useState(null),[y,h]=r.useState(!0),[p,u]=r.useState(!1),[m,n]=r.useState(""),[x,o]=r.useState(""),[d,_]=r.useState(!1),[a,g]=r.useState({api_url:"",api_token:"",shop_id:"",enabled:!1});r.useEffect(()=>{f()},[]);const f=async()=>{try{h(!0);const{data:t,error:s}=await c.from("legal_config").select("*").limit(1).maybeSingle();if(s)throw s;t&&(j(t),g({api_url:t.api_url,api_token:t.api_token,shop_id:t.shop_id,enabled:t.enabled}))}catch(t){n(t instanceof Error?t.message:"Fehler beim Laden der Konfiguration")}finally{h(!1)}},i=t=>{const{name:s,type:k,value:w,checked:v}=t.target;g(S=>({...S,[s]:k==="checkbox"?v:w})),o(""),n("")},N=async t=>{if(t.preventDefault(),n(""),o(""),!a.api_url||!a.api_token||!a.shop_id){n("Bitte füllen Sie alle erforderlichen Felder aus");return}try{if(u(!0),l){const{error:s}=await c.from("legal_config").update({api_url:a.api_url,api_token:a.api_token,shop_id:a.shop_id,enabled:a.enabled,updated_at:new Date().toISOString()}).eq("id",l.id);if(s)throw s}else{const{error:s}=await c.from("legal_config").insert([{api_url:a.api_url,api_token:a.api_token,shop_id:a.shop_id,enabled:a.enabled}]);if(s)throw s}o("Konfiguration erfolgreich gespeichert"),f()}catch(s){n(s instanceof Error?s.message:"Fehler beim Speichern")}finally{u(!1)}};return y?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(I,{className:"w-8 h-8 animate-spin text-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"IT-Recht Kanzlei API Konfiguration"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Verwalten Sie die Verbindung zur IT-Recht Kanzlei für automatische Rechtstext-Updates"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(b,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-semibold",children:"Wie Sie die Zugangsdaten erhalten:"}),e.jsxs("ol",{className:"mt-2 space-y-1 ml-4 list-decimal",children:[e.jsx("li",{children:"Melden Sie sich im IT-Recht Kanzlei Mandantenportal an"}),e.jsx("li",{children:"Navigieren Sie zu: Einstellungen → Schnittstellen → API-Zugang"}),e.jsx("li",{children:"Aktivieren Sie die API und kopieren Sie API-URL, Token und Shop-ID"})]})]})]})}),e.jsxs("form",{onSubmit:N,className:"bg-white rounded-lg shadow p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"api_url",className:"block text-sm font-medium text-gray-700 mb-2",children:"API-URL"}),e.jsx("input",{type:"text",id:"api_url",name:"api_url",value:a.api_url,onChange:i,placeholder:"https://www.it-recht-kanzlei.de/api/v1",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Standard: https://www.it-recht-kanzlei.de/api/v1"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"shop_id",className:"block text-sm font-medium text-gray-700 mb-2",children:"Shop-ID / Mandanten-Nummer"}),e.jsx("input",{type:"text",id:"shop_id",name:"shop_id",value:a.shop_id,onChange:i,placeholder:"z.B. 12345",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"api_token",className:"block text-sm font-medium text-gray-700 mb-2",children:"API-Token"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:d?"text":"password",id:"api_token",name:"api_token",value:a.api_token,onChange:i,placeholder:"Ihr API-Token...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-transparent pr-10"}),e.jsx("button",{type:"button",onClick:()=>_(!d),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:d?e.jsx(C,{className:"w-5 h-5"}):e.jsx(A,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"enabled",name:"enabled",checked:a.enabled,onChange:i,className:"w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-600"}),e.jsx("label",{htmlFor:"enabled",className:"text-sm font-medium text-gray-700",children:"API aktivieren"})]}),m&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex gap-3",children:[e.jsx(b,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-800",children:m})]}),x&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 flex gap-3",children:[e.jsx(E,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-green-800",children:x})]}),e.jsx("button",{type:"submit",disabled:p,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-medium py-2 px-4 rounded-lg transition",children:p?"Speichern...":"Konfiguration speichern"})]}),l&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 text-sm text-gray-600",children:e.jsxs("p",{children:["Zuletzt aktualisiert: ",new Date(l.updated_at).toLocaleString("de-DE")]})})]})}export{T as default};
