import{s as m,j as e}from"./index-qr1N3yx6.js";import{r as l}from"./react-vendor-CyQtAcHN.js";import{z as G,y as J,X as F,K as W,N as X,o as N,R as O,x as z,l as E,m as q,e as U,f as Z,O as H,V as L,Y as Q,h as ee,d as se,Z as te}from"./icons-D7vnYvoJ.js";import"./supabase-BIynZPkb.js";function re(){const[i,g]=l.useState([]),[h,v]=l.useState(null),[n,c]=l.useState({}),[S,j]=l.useState(!1),[b,x]=l.useState("");l.useEffect(()=>{u()},[]);const u=async()=>{const{data:t}=await m.from("testimonials").select("*").order("order_index");t&&g(t)},_=t=>{v(t.id),c(t)},f=()=>{v(null),c({})},y=async()=>{if(!h)return;const{error:t}=await m.from("testimonials").update(n).eq("id",h);t||(x("Erfolgreich gespeichert"),u(),f(),setTimeout(()=>x(""),3e3))},I=async()=>{const{error:t}=await m.from("testimonials").insert([{...n,order_index:i.length,is_active:!0}]);t||(x("Bewertung hinzugefügt"),u(),j(!1),c({}),setTimeout(()=>x(""),3e3))},w=async t=>{if(!confirm("Möchten Sie diese Bewertung wirklich löschen?"))return;const{error:a}=await m.from("testimonials").delete().eq("id",t);a||(x("Erfolgreich gelöscht"),u(),setTimeout(()=>x(""),3e3))},o=t=>Array.from({length:5},(a,p)=>e.jsx(N,{className:`h-5 w-5 ${p<t?"text-yellow-400 fill-current":"text-gray-300"}`},p));return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Bewertungen"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Kundenbewertungen verwalten"})]}),e.jsxs("button",{onClick:()=>j(!0),className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(G,{className:"h-5 w-5"}),e.jsx("span",{children:"Hinzufügen"})]})]}),b&&e.jsx("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-lg text-green-800",children:b}),S&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Neue Bewertung hinzufügen"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Kundenname",value:n.customer_name||"",onChange:t=>c({...n,customer_name:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"}),e.jsx("textarea",{placeholder:"Bewertungstext",value:n.content||"",onChange:t=>c({...n,content:t.target.value}),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bewertung"}),e.jsxs("select",{value:n.rating||5,onChange:t=>c({...n,rating:parseInt(t.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:5,children:"5 Sterne"}),e.jsx("option",{value:4,children:"4 Sterne"}),e.jsx("option",{value:3,children:"3 Sterne"}),e.jsx("option",{value:2,children:"2 Sterne"}),e.jsx("option",{value:1,children:"1 Stern"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:I,className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",children:"Speichern"}),e.jsx("button",{onClick:()=>{j(!1),c({})},className:"bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400",children:"Abbrechen"})]})]})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:i.map(t=>e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:h===t.id?e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",value:n.customer_name||"",onChange:a=>c({...n,customer_name:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"}),e.jsx("textarea",{value:n.content||"",onChange:a=>c({...n,content:a.target.value}),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg"}),e.jsxs("select",{value:n.rating||5,onChange:a=>c({...n,rating:parseInt(a.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:5,children:"5 Sterne"}),e.jsx("option",{value:4,children:"4 Sterne"}),e.jsx("option",{value:3,children:"3 Sterne"}),e.jsx("option",{value:2,children:"2 Sterne"}),e.jsx("option",{value:1,children:"1 Stern"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:y,className:"flex items-center space-x-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx("span",{children:"Speichern"})]}),e.jsxs("button",{onClick:f,className:"flex items-center space-x-2 bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx("span",{children:"Abbrechen"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"flex",children:o(t.rating)}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>_(t),className:"text-blue-600 hover:text-blue-900",children:e.jsx(W,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>w(t.id),className:"text-red-600 hover:text-red-900",children:e.jsx(X,{className:"h-5 w-5"})})]})]}),e.jsx("p",{className:"text-gray-600 mb-3",children:t.content}),e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:["- ",t.customer_name]})]})},t.id))})]})}function ae(){const[i,g]=l.useState([]),[h,v]=l.useState([]),[n,c]=l.useState({total:0,visible:0,featured:0,average_rating:0,five_star:0,four_star:0,three_star:0,two_star:0,one_star:0}),[S,j]=l.useState(!0),[b,x]=l.useState(!1),[u,_]=l.useState("all"),[f,y]=l.useState(!1),[I,w]=l.useState(!1),[o,t]=l.useState(!1),[a,p]=l.useState({author_name:"",rating:5,text:"",time:new Date().toISOString().split("T")[0],author_photo_url:""});l.useEffect(()=>{C(),R()},[]),l.useEffect(()=>{i.length>0&&P(i)},[i]);const C=async()=>{try{const{data:s,error:r}=await m.from("google_reviews").select("*").order("time",{ascending:!1});if(r)throw r;g(s||[])}catch(s){console.error("Error fetching reviews:",s)}finally{j(!1)}},R=async()=>{try{const{data:s,error:r}=await m.from("google_reviews_sync_log").select("*").order("synced_at",{ascending:!1}).limit(10);if(r)throw r;v(s||[])}catch(s){console.error("Error fetching sync logs:",s)}},P=s=>{const r=s.reduce((d,K)=>d+K.rating,0),k={total:s.length,visible:s.filter(d=>d.is_visible).length,featured:s.filter(d=>d.is_featured).length,average_rating:s.length>0?r/s.length:0,five_star:s.filter(d=>d.rating===5).length,four_star:s.filter(d=>d.rating===4).length,three_star:s.filter(d=>d.rating===3).length,two_star:s.filter(d=>d.rating===2).length,one_star:s.filter(d=>d.rating===1).length};c(k)},A=async()=>{x(!0);try{const s=await fetch("https://lnimxmbghbdadbotjyan.supabase.co/functions/v1/sync-google-reviews",{method:"POST",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxuaW14bWJnaGJkYWRib3RqeWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxMjMzMzgsImV4cCI6MjA4MDY5OTMzOH0.4jrkeiOdsY__oJ5FNFVYmcju2uklb5jXYYiUVt3F_Aw","Content-Type":"application/json",apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxuaW14bWJnaGJkYWRib3RqeWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxMjMzMzgsImV4cCI6MjA4MDY5OTMzOH0.4jrkeiOdsY__oJ5FNFVYmcju2uklb5jXYYiUVt3F_Aw"},body:JSON.stringify({triggeredBy:"manual"})}),r=await s.json();if(!s.ok)throw new Error(r.error||"Sync failed");alert(`Erfolg! ${r.totalReviews} Bewertungen synchronisiert (${r.newReviews} neu, ${r.updatedReviews} aktualisiert)`),await C(),await R()}catch(s){console.error("Error syncing reviews:",s),alert(`Fehler beim Synchronisieren: ${s.message}`)}finally{x(!1)}},T=async()=>{if(!a.author_name||!a.text){alert("Bitte Name und Bewertungstext ausfüllen");return}t(!0);try{const r=`manual_${new Date(a.time).getTime()}_${a.author_name.replace(/\s/g,"_")}`,{error:k}=await m.from("google_reviews").insert({google_review_id:r,author_name:a.author_name,author_photo_url:a.author_photo_url||null,rating:a.rating,text:a.text,time:new Date(a.time).toISOString(),relative_time_description:"Manuell importiert",is_visible:!0,is_featured:a.rating===5});if(k)throw k;alert("Bewertung erfolgreich hinzugefügt!"),w(!1),p({author_name:"",rating:5,text:"",time:new Date().toISOString().split("T")[0],author_photo_url:""}),await C()}catch(s){console.error("Error importing review:",s),alert(`Fehler beim Importieren: ${s.message}`)}finally{t(!1)}},$=async s=>{try{const{error:r}=await m.from("google_reviews").update({is_visible:!s.is_visible}).eq("id",s.id);if(r)throw r;await C()}catch(r){console.error("Error toggling visibility:",r),alert("Fehler beim Aktualisieren der Sichtbarkeit")}},Y=async s=>{try{const{error:r}=await m.from("google_reviews").update({is_featured:!s.is_featured}).eq("id",s.id);if(r)throw r;await C()}catch(r){console.error("Error toggling featured:",r),alert("Fehler beim Aktualisieren des Featured-Status")}},M=s=>new Date(s).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),V=s=>e.jsx("div",{className:"flex",children:[1,2,3,4,5].map(r=>e.jsx(N,{className:`w-4 h-4 ${r<=s?"text-yellow-400 fill-yellow-400":"text-gray-300"}`},r))}),B=(()=>{let s=[...i];return u!=="all"&&(s=s.filter(r=>r.rating===u)),f&&(s=s.filter(r=>r.is_visible)),s})();return S?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-600",children:"Lade Bewertungen..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Google Reviews Verwaltung"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:()=>w(!0),className:"inline-flex items-center space-x-2 bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors",children:[e.jsx(G,{className:"w-5 h-5"}),e.jsx("span",{children:"Manuell hinzufügen"})]}),e.jsxs("button",{onClick:A,disabled:b,className:"inline-flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(O,{className:`w-5 h-5 ${b?"animate-spin":""}`}),e.jsx("span",{children:b?"Synchronisieren":"Google Sync"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Gesamt"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:n.total})]}),e.jsx(N,{className:"w-12 h-12 text-blue-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Sichtbar"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:n.visible})]}),e.jsx(z,{className:"w-12 h-12 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Featured"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-600",children:n.featured})]}),e.jsx(E,{className:"w-12 h-12 text-yellow-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Durchschnitt"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-500",children:n.average_rating.toFixed(1)})]}),e.jsx(q,{className:"w-12 h-12 text-yellow-500"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"Bewertungsverteilung"}),e.jsx("div",{className:"space-y-3",children:[5,4,3,2,1].map(s=>{const r=n[`${["","","one","two","three","four","five"][s]}_star`],k=n.total>0?r/n.total*100:0;return e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-1 w-20",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:s}),e.jsx(N,{className:"w-4 h-4 text-yellow-400 fill-yellow-400"})]}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-4",children:e.jsx("div",{className:"bg-yellow-400 h-4 rounded-full transition-all",style:{width:`${k}%`}})}),e.jsx("span",{className:"text-sm font-medium text-gray-700 w-12 text-right",children:r})]},s)})})]}),h.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"Letzte Synchronisationen"}),e.jsx("div",{className:"space-y-2",children:h.slice(0,5).map(s=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b last:border-b-0",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(U,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600",children:M(s.synced_at)}),s.status==="success"?e.jsx(Z,{className:"w-4 h-4 text-green-600"}):e.jsx(F,{className:"w-4 h-4 text-red-600"})]}),e.jsxs("div",{className:"text-sm text-gray-700",children:[s.reviews_count," Reviews (",s.new_reviews_count," neu)",s.triggered_by==="manual"&&e.jsx("span",{className:"ml-2 text-xs text-blue-600",children:"(Manuell)"})]})]},s.id))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("select",{value:u,onChange:s=>_(s.target.value==="all"?"all":Number(s.target.value)),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"Alle Bewertungen"}),e.jsx("option",{value:"5",children:"5 Sterne"}),e.jsx("option",{value:"4",children:"4 Sterne"}),e.jsx("option",{value:"3",children:"3 Sterne"}),e.jsx("option",{value:"2",children:"2 Sterne"}),e.jsx("option",{value:"1",children:"1 Stern"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:s=>y(s.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Nur sichtbare"})]})]})}),e.jsxs("div",{className:"divide-y divide-gray-200",children:[B.map(s=>e.jsx("div",{className:"p-6 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex space-x-4 flex-1",children:[s.author_photo_url&&e.jsx("img",{src:s.author_photo_url,alt:s.author_name,className:"w-12 h-12 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.author_name}),s.is_featured&&e.jsx(E,{className:"w-4 h-4 text-yellow-500"})]}),V(s.rating),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:M(s.time)}),s.text&&e.jsx("p",{className:"text-gray-700 mt-3",children:s.text})]})]}),e.jsxs("div",{className:"flex flex-col space-y-2 ml-4",children:[e.jsx("button",{onClick:()=>$(s),className:`p-2 rounded-lg transition-colors ${s.is_visible?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,title:s.is_visible?"Ausblenden":"Einblenden",children:s.is_visible?e.jsx(z,{className:"w-5 h-5"}):e.jsx(H,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>Y(s),className:`p-2 rounded-lg transition-colors ${s.is_featured?"bg-yellow-100 text-yellow-700 hover:bg-yellow-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,title:s.is_featured?"Von Featured entfernen":"Als Featured markieren",children:e.jsx(E,{className:"w-5 h-5"})})]})]})},s.id)),B.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(N,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Keine Bewertungen gefunden"}),i.length===0&&e.jsx("button",{onClick:A,disabled:b,className:"mt-4 text-blue-600 hover:text-blue-700 font-medium",children:"Jetzt Google Reviews synchronisieren"})]})]})]}),I&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Bewertung manuell hinzufügen"}),e.jsx("button",{onClick:()=>w(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(F,{className:"w-6 h-6"})})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Hinweis: Google Places API gibt max. 5 Reviews zurück. Hier können Sie weitere Bewertungen manuell hinzufügen."})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name des Bewerters *"}),e.jsx("input",{type:"text",value:a.author_name,onChange:s=>p({...a,author_name:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"z.B. Max Mustermann"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bewertung *"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[[1,2,3,4,5].map(s=>e.jsx("button",{onClick:()=>p({...a,rating:s}),className:"focus:outline-none",children:e.jsx(N,{className:`w-8 h-8 transition-colors ${s<=a.rating?"text-yellow-400 fill-yellow-400":"text-gray-300"}`})},s)),e.jsxs("span",{className:"ml-2 text-lg font-medium text-gray-700",children:[a.rating," Stern",a.rating!==1?"e":""]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bewertungstext *"}),e.jsx("textarea",{value:a.text,onChange:s=>p({...a,text:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:4,placeholder:"Bewertungstext..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Datum der Bewertung *"}),e.jsx("input",{type:"date",value:a.time,onChange:s=>p({...a,time:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Profilbild-URL (optional)"}),e.jsx("input",{type:"url",value:a.author_photo_url,onChange:s=>p({...a,author_photo_url:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"https://..."})]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-200 flex items-center justify-end space-x-3",children:[e.jsx("button",{onClick:()=>w(!1),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Abbrechen"}),e.jsx("button",{onClick:T,disabled:o,className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:o?"Wird hinzugefügt...":"Bewertung hinzufügen"})]})]})})]})}const D="00000000-0000-0000-0000-000000000001";function le(){const[i,g]=l.useState(null),[h,v]=l.useState(""),[n,c]=l.useState(""),[S,j]=l.useState(!1),[b,x]=l.useState(!0),[u,_]=l.useState(!1),[f,y]=l.useState(null);l.useEffect(()=>{I()},[]);const I=async()=>{try{const{data:o,error:t}=await m.from("google_settings").select("*").eq("id",D).maybeSingle();if(t)throw t;o&&(g(o),v(o.api_key||""),c(o.place_id||""),j(o.auto_sync_enabled||!1))}catch(o){console.error("Error fetching settings:",o),y({type:"error",text:"Fehler beim Laden der Einstellungen"})}finally{x(!1)}},w=async o=>{o.preventDefault(),_(!0),y(null);try{const{error:t}=await m.from("google_settings").update({api_key:h.trim()||null,place_id:n.trim()||null,auto_sync_enabled:S,updated_at:new Date().toISOString()}).eq("id",D);if(t)throw t;y({type:"success",text:"Einstellungen erfolgreich gespeichert!"}),I()}catch(t){console.error("Error saving settings:",t),y({type:"error",text:"Fehler beim Speichern der Einstellungen"})}finally{_(!1)}};return b?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"max-w-2xl",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(L,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-2",children:"So richten Sie Google Reviews ein:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1 ml-2",children:[e.jsxs("li",{children:["Besuchen Sie die ",e.jsx("a",{href:"https://console.cloud.google.com/",target:"_blank",rel:"noopener noreferrer",className:"underline font-medium",children:"Google Cloud Console"})]}),e.jsx("li",{children:"Erstellen Sie ein neues Projekt oder wählen Sie ein bestehendes aus"}),e.jsx("li",{children:'Aktivieren Sie die "Places API" für Ihr Projekt'}),e.jsx("li",{children:'Erstellen Sie einen API-Schlüssel unter "APIs & Dienste" → "Anmeldedaten"'}),e.jsxs("li",{children:["Finden Sie Ihre Place ID über die ",e.jsx("a",{href:"https://developers.google.com/maps/documentation/places/web-service/place-id",target:"_blank",rel:"noopener noreferrer",className:"underline font-medium",children:"Place ID Finder"})]})]})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Google API Einstellungen"}),f&&e.jsx("div",{className:`mb-6 p-4 rounded-lg ${f.type==="success"?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"}`,children:f.text}),e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Google Places API Key"]}),e.jsx("input",{type:"text",value:h,onChange:o=>v(o.target.value),placeholder:"AIzaSy...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Ihr API-Schlüssel aus der Google Cloud Console"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Google Place ID"]}),e.jsx("input",{type:"text",value:n,onChange:o=>c(o.target.value),placeholder:"ChIJ...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Die eindeutige ID Ihres Google Business Profils"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(O,{className:"w-5 h-5 text-gray-600 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Automatische Synchronisierung"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Reviews automatisch alle 24 Stunden abrufen"})]})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:S,onChange:o=>j(o.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),(i==null?void 0:i.last_sync_at)&&e.jsxs("div",{className:"text-xs text-gray-500 bg-gray-50 p-3 rounded",children:["Letzte Synchronisierung: ",new Date(i.last_sync_at).toLocaleString("de-DE")]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs("button",{type:"submit",disabled:u,className:"flex items-center space-x-2 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx(J,{className:"w-4 h-4"}),e.jsx("span",{children:u?"Speichern...":"Einstellungen speichern"})]})})]})]})]})}function xe(){const[i,g]=l.useState("testimonials");return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Google Bewertungen"}),e.jsx("p",{className:"text-gray-600",children:"Verwalten Sie Kundenbewertungen und Google Reviews"})]}),e.jsx("div",{className:"border-b border-gray-200 mb-6",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsxs("button",{onClick:()=>g("testimonials"),className:`
              flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors
              ${i==="testimonials"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
            `,children:[e.jsx(N,{className:"w-5 h-5"}),e.jsx("span",{children:"Bewertungen"})]}),e.jsxs("button",{onClick:()=>g("reviews"),className:`
              flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors
              ${i==="reviews"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
            `,children:[e.jsx(se,{className:"w-5 h-5"}),e.jsx("span",{children:"Google Reviews"})]}),e.jsxs("button",{onClick:()=>g("settings"),className:`
              flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors
              ${i==="settings"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
            `,children:[e.jsx(te,{className:"w-5 h-5"}),e.jsx("span",{children:"Einstellungen"})]})]})}),e.jsxs("div",{className:"mt-6",children:[i==="testimonials"&&e.jsx(re,{}),i==="reviews"&&e.jsx(ae,{}),i==="settings"&&e.jsx(le,{})]})]})}export{xe as default};
