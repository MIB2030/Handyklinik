import{s as x,j as e}from"./index-FSvjR5TH.js";import{r as i}from"./react-vendor-b3UjsJu-.js";import{Z as N,a3 as w,K as z,X as _,z as I,V as M,Q as V}from"./icons-CQN5Kxvf.js";import"./supabase-D5NMW07i.js";const m=[{value:"red",label:"Rot (Wichtig/Warnung)",bgClass:"bg-red-100",textClass:"text-red-800",borderClass:"border-red-200"},{value:"blue",label:"Blau (Information)",bgClass:"bg-blue-100",textClass:"text-blue-800",borderClass:"border-blue-200"},{value:"green",label:"Grün (Erfolg/Positiv)",bgClass:"bg-green-100",textClass:"text-green-800",borderClass:"border-green-200"},{value:"orange",label:"Orange (Aufmerksamkeit)",bgClass:"bg-orange-100",textClass:"text-orange-800",borderClass:"border-orange-200"},{value:"yellow",label:"Gelb (Hinweis)",bgClass:"bg-yellow-100",textClass:"text-yellow-800",borderClass:"border-yellow-200"}],o={red:{bg:"bg-red-50",border:"border-red-200",text:"text-red-900",title:"text-red-800",button:"bg-red-600 hover:bg-red-700"},blue:{bg:"bg-blue-50",border:"border-blue-200",text:"text-blue-900",title:"text-blue-800",button:"bg-blue-600 hover:bg-blue-700"},green:{bg:"bg-green-50",border:"border-green-200",text:"text-green-900",title:"text-green-800",button:"bg-green-600 hover:bg-green-700"},orange:{bg:"bg-orange-50",border:"border-orange-200",text:"text-orange-900",title:"text-orange-800",button:"bg-orange-600 hover:bg-orange-700"},yellow:{bg:"bg-yellow-50",border:"border-yellow-200",text:"text-yellow-900",title:"text-yellow-800",button:"bg-yellow-600 hover:bg-yellow-700"}};function q(){const[b,k]=i.useState([]),[C,S]=i.useState(!0),[c,u]=i.useState(null),[s,l]=i.useState({title:"",message:"",color:"blue",content_type:"text",html_content:"",is_active:!0,start_date:new Date().toISOString().slice(0,16),end_date:new Date(Date.now()+7*24*60*60*1e3).toISOString().slice(0,16)}),[p,d]=i.useState(null),[y,n]=i.useState(null);i.useEffect(()=>{h()},[]);const h=async()=>{try{const{data:t,error:r}=await x.from("announcements").select("*").order("created_at",{ascending:!1});if(r)throw r;k(t||[])}catch(t){d("Fehler beim Laden der Ankündigungen"),console.error(t)}finally{S(!1)}},D=async t=>{t.preventDefault(),d(null),n(null);try{if(c){const{error:r}=await x.from("announcements").update(s).eq("id",c);if(r)throw r;n("Änderungen wurden gespeichert und sind sofort für Endkunden sichtbar!")}else{const{error:r}=await x.from("announcements").insert([s]);if(r)throw r;n("Pop-up wurde erstellt und ist sofort für Endkunden sichtbar!")}l({title:"",message:"",color:"blue",content_type:"text",html_content:"",is_active:!0,start_date:new Date().toISOString().slice(0,16),end_date:new Date(Date.now()+7*24*60*60*1e3).toISOString().slice(0,16)}),u(null),h(),setTimeout(()=>n(null),5e3)}catch(r){d("Fehler beim Speichern der Ankündigung"),console.error(r)}},E=t=>{l({title:t.title,message:t.message,color:t.color,content_type:t.content_type,html_content:t.html_content||"",is_active:t.is_active,start_date:new Date(t.start_date).toISOString().slice(0,16),end_date:new Date(t.end_date).toISOString().slice(0,16)}),u(t.id),window.scrollTo({top:0,behavior:"smooth"})},A=async t=>{if(confirm("Möchten Sie diese Ankündigung wirklich löschen?"))try{const{error:r}=await x.from("announcements").delete().eq("id",t);if(r)throw r;h()}catch(r){d("Fehler beim Löschen der Ankündigung"),console.error(r)}},P=async(t,r)=>{d(null),n(null);try{const{error:a}=await x.from("announcements").update({is_active:!r}).eq("id",t);if(a)throw a;n(!r?"Pop-up wurde aktiviert und ist jetzt für Endkunden sichtbar!":"Pop-up wurde deaktiviert und ist nicht mehr für Endkunden sichtbar!"),h(),setTimeout(()=>n(null),5e3)}catch(a){d("Fehler beim Aktualisieren des Status"),console.error(a)}},T=t=>m.find(a=>a.value===t)||m[1],L=t=>{if(!t.is_active)return!1;const r=new Date,a=new Date(t.start_date),g=new Date(t.end_date);return r>=a&&r<=g};return C?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-gray-600",children:"Laden..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Pop-up Ankündigungen"})}),p&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-center gap-2",children:[e.jsx(N,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{children:p})]}),y&&e.jsxs("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg flex items-center gap-2 animate-fadeIn",children:[e.jsx("div",{className:"w-5 h-5 flex-shrink-0 flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),e.jsx("span",{className:"font-medium",children:y})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:c?"Ankündigung bearbeiten":"Neue Ankündigung"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Änderungen werden sofort für alle Endkunden wirksam. Deaktivierte Pop-ups werden nicht mehr angezeigt."})]}),e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Inhaltstyp *"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"content_type",value:"text",checked:s.content_type==="text",onChange:t=>l({...s,content_type:"text"}),className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Kurzer Text"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"content_type",value:"html",checked:s.content_type==="html",onChange:t=>l({...s,content_type:"html"}),className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"HTML-Code (Vollbild)"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.content_type==="text"?"Einfaches Text-Popup mit Titel und Nachricht":"Vollständige HTML-Seite im Popup (z.B. Stellenanzeige)"})]}),s.content_type==="text"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Titel (optional)"}),e.jsx("input",{type:"text",value:s.title,onChange:t=>l({...s,title:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"z.B. Wichtige Ankündigung"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nachricht *"}),e.jsx("textarea",{value:s.message,onChange:t=>l({...s,message:t.target.value}),required:s.content_type==="text",rows:4,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ihre Ankündigungsnachricht..."})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"HTML-Code *"}),e.jsx("textarea",{value:s.html_content,onChange:t=>l({...s,html_content:t.target.value}),required:s.content_type==="html",rows:12,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono text-sm",placeholder:`<!DOCTYPE html>
<html>
<head>
  <title>Ihre Seite</title>
</head>
<body>
  ...
</body>
</html>`}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Vollständiger HTML-Code inkl. <html>, <head> und <body> Tags"})]}),s.content_type==="text"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Farbe *"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:m.map(t=>e.jsxs("label",{className:`flex items-center gap-3 p-3 border-2 rounded-lg cursor-pointer transition-all ${s.color===t.value?`${t.borderClass} ${t.bgClass}`:"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"color",value:t.value,checked:s.color===t.value,onChange:r=>l({...s,color:r.target.value}),className:"w-4 h-4"}),e.jsx("span",{className:`font-medium ${s.color===t.value?t.textClass:"text-gray-700"}`,children:t.label})]},t.value))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Startdatum *"}),e.jsx("input",{type:"datetime-local",value:s.start_date,onChange:t=>l({...s,start_date:t.target.value}),required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Enddatum *"}),e.jsx("input",{type:"datetime-local",value:s.end_date,onChange:t=>l({...s,end_date:t.target.value}),required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:s.is_active,onChange:t=>l({...s,is_active:t.target.checked}),className:"w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"is_active",className:"text-sm font-medium text-gray-900",children:"Pop-up für Endkunden aktivieren"})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-2 ml-7",children:s.is_active?"Das Pop-up wird Endkunden im angegebenen Zeitraum angezeigt":"Das Pop-up ist deaktiviert und wird Endkunden nicht angezeigt"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{type:"submit",className:"px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 font-semibold shadow-md hover:shadow-lg",children:c?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-5 h-5"}),"Änderungen speichern"]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"w-5 h-5"}),"Pop-up erstellen"]})}),c&&e.jsx("button",{type:"button",onClick:()=>{u(null),l({title:"",message:"",color:"blue",content_type:"text",html_content:"",is_active:!0,start_date:new Date().toISOString().slice(0,16),end_date:new Date(Date.now()+7*24*60*60*1e3).toISOString().slice(0,16)})},className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:"Abbrechen"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Live-Vorschau"}),e.jsx("p",{className:"text-sm text-gray-600",children:"So wird das Pop-up für Endkunden angezeigt"})]}),e.jsx("div",{className:"relative bg-gray-100 rounded-lg p-4 min-h-[400px] flex items-center justify-center",children:s.content_type==="html"&&s.html_content?e.jsxs("div",{className:"relative w-full h-[500px]",children:[e.jsx("div",{className:"absolute top-2 right-2 z-10",children:e.jsx("button",{type:"button",className:"p-2 rounded-full bg-red-600 text-white shadow-lg",disabled:!0,children:e.jsx(_,{className:"w-5 h-5"})})}),e.jsx("iframe",{srcDoc:s.html_content,className:"w-full h-full border-2 border-gray-300 rounded-lg",title:"HTML Vorschau",sandbox:"allow-same-origin allow-scripts allow-forms"})]}):s.content_type==="text"&&s.message?e.jsx("div",{className:"relative w-full max-w-md",children:e.jsxs("div",{className:`relative ${o[s.color].bg} ${o[s.color].border} border-2 rounded-2xl shadow-2xl p-6 md:p-8`,children:[e.jsx("button",{type:"button",className:`absolute top-4 right-4 p-2 rounded-full ${o[s.color].button} text-white transition-all hover:scale-110`,disabled:!0,children:e.jsx(_,{className:"w-5 h-5"})}),e.jsxs("div",{className:"pr-10",children:[s.title&&e.jsx("h2",{className:`text-2xl md:text-3xl font-bold ${o[s.color].title} mb-4`,children:s.title}),e.jsx("p",{className:`text-base md:text-lg ${o[s.color].text} whitespace-pre-wrap leading-relaxed`,children:s.message})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{type:"button",className:`px-6 py-3 ${o[s.color].button} text-white font-semibold rounded-lg transition-all hover:scale-105`,disabled:!0,children:"Verstanden"})})]})}):e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx(N,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:s.content_type==="text"?"Geben Sie eine Nachricht ein, um die Vorschau zu sehen":"Geben Sie HTML-Code ein, um die Vorschau zu sehen"})]})}),e.jsxs("div",{className:"mt-4 text-xs text-gray-500 space-y-1",children:[e.jsx("p",{children:"• Die Vorschau zeigt das exakte Design des Popups"}),e.jsx("p",{children:"• Buttons in der Vorschau sind deaktiviert"}),s.content_type==="html"?e.jsx("p",{children:"• HTML-Popups werden im Vollbild angezeigt"}):e.jsx("p",{children:"• Das echte Popup wird mittig auf dem Bildschirm angezeigt"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Alle Ankündigungen"})}),b.length===0?e.jsx("div",{className:"px-6 py-12 text-center text-gray-500",children:"Keine Ankündigungen vorhanden. Erstellen Sie die erste Ankündigung oben."}):e.jsx("div",{className:"divide-y divide-gray-200",children:b.map(t=>{var g,f,j,v;const r=T(t.color),a=L(t);return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[t.content_type==="text"&&t.title&&e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t.title}),t.content_type==="html"&&e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"HTML Pop-up"}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${t.content_type==="html"?"bg-purple-100 text-purple-800":`${r.bgClass} ${r.textClass}`}`,children:t.content_type==="html"?"HTML (Vollbild)":(g=m.find($=>$.value===t.color))==null?void 0:g.label.split(" ")[0]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${a?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"}`,children:a?"Aktiv":"Inaktiv"})]}),t.content_type==="text"?e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:t.message}):e.jsxs("p",{className:"text-gray-600 text-sm italic",children:["HTML-Code (",((f=t.html_content)==null?void 0:f.length)||0," Zeichen)"]}),e.jsx("div",{className:"text-sm text-gray-500 space-y-1",children:e.jsxs("div",{children:["Von: ",new Date(t.start_date).toLocaleString("de-DE")," "," Bis: ",new Date(t.end_date).toLocaleString("de-DE")]})}),t.content_type==="text"?e.jsxs("div",{className:`mt-3 p-4 rounded-lg border-2 ${r.bgClass} ${r.borderClass}`,children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Vorschau:"}),t.title&&e.jsx("h4",{className:`text-lg font-bold mb-2 ${r.textClass}`,children:t.title}),e.jsx("p",{className:`${r.textClass}`,children:t.message})]}):e.jsxs("div",{className:"mt-3 p-4 rounded-lg border-2 bg-gray-50 border-gray-300",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"HTML Vorschau:"}),e.jsx("div",{className:"bg-white border border-gray-300 rounded p-2 max-h-40 overflow-auto",children:e.jsxs("code",{className:"text-xs text-gray-700 whitespace-pre-wrap font-mono",children:[(j=t.html_content)==null?void 0:j.substring(0,200),(((v=t.html_content)==null?void 0:v.length)||0)>200&&"..."]})})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{onClick:()=>P(t.id,t.is_active),className:`px-4 py-2 rounded-lg transition-all font-medium text-sm flex items-center gap-2 ${t.is_active?"bg-green-100 text-green-700 hover:bg-green-200 border border-green-300":"bg-gray-100 text-gray-700 hover:bg-gray-200 border border-gray-300"}`,title:t.is_active?"Für Endkunden deaktivieren":"Für Endkunden aktivieren",children:t.is_active?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Aktiv"})]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Inaktiv"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>E(t),className:"p-2 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 transition-colors",title:"Bearbeiten",children:e.jsx(w,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>A(t.id),className:"p-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition-colors",title:"Löschen",children:e.jsx(V,{className:"w-5 h-5"})})]})]})]})},t.id)})})]})]})}export{q as default};
